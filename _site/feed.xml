<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>HyperEcho</title>
        <description>Homebase for cloud solution projects and innovative technology blogs!</description>
        <link>http://localhost:4000/</link>
        <atom:link href="http://localhost:4000/feed.xml" rel="self" type="application/rss+xml"/>
        <pubDate>Thu, 29 May 2025 11:26:07 -0500</pubDate>
        <lastBuildDate>Thu, 29 May 2025 11:26:07 -0500</lastBuildDate>
        <generator>Jekyll v4.4.1</generator>
        
            <item>
                <title>Getting Started with Microsoft Graph PowerShell SDK A Practical Guide</title>
                <description>&lt;h1 id=&quot;getting-started-with-microsoft-graph-powershell-sdk-a-practical-guide&quot;&gt;Getting Started with Microsoft Graph PowerShell SDK: A Practical Guide&lt;/h1&gt;

&lt;h2 id=&quot;overview-what-is-the-microsoft-graph-powershell-sdk&quot;&gt;Overview: What is the Microsoft Graph PowerShell SDK?&lt;/h2&gt;

&lt;p&gt;The &lt;strong&gt;Microsoft Graph PowerShell SDK&lt;/strong&gt; is a module that enables administrators and developers to interact with Microsoft Graph via PowerShell. Microsoft Graph itself is a RESTful web API that acts as a single endpoint to access data and intelligence from Microsoft 365 services such as Exchange Online, Microsoft Teams, SharePoint, OneDrive, and Azure Active Directory (Azure AD).&lt;/p&gt;

&lt;p&gt;This SDK abstracts the complexities of direct API calls by providing a structured, PowerShell-native interface. It allows scripting and automation of various administrative tasks without writing raw HTTP requests.&lt;/p&gt;

&lt;h3 id=&quot;use-cases&quot;&gt;Use Cases&lt;/h3&gt;

&lt;p&gt;Common scenarios where the SDK is especially useful include:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Automating Microsoft 365 administration&lt;/strong&gt;: Tasks like managing Teams policies, provisioning mailboxes, or handling Azure AD users can be scripted and scheduled.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Querying and modifying user data&lt;/strong&gt;: Retrieve user profiles, update properties, or manage licenses programmatically.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Batch operations and scheduled jobs&lt;/strong&gt;: Integrate with task schedulers or CI/CD pipelines to perform repetitive jobs, like compliance checks or usage reporting.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;key-benefits&quot;&gt;Key Benefits&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Unified authentication and permissions model&lt;/strong&gt;: Uses the Microsoft identity platform for consistent access control across services.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Flexible authentication options&lt;/strong&gt;: Supports interactive login (useful for testing) and non-interactive authentication such as certificate-based or client secret flows for service accounts.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Cross-platform compatibility&lt;/strong&gt;: Operates across Windows PowerShell 5.1 and PowerShell Core (v7+), enabling use on Windows, Linux, and macOS.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Standardized, discoverable cmdlets&lt;/strong&gt;: Cmdlets follow a predictable naming pattern (e.g., &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Get-MgUser&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;New-MgTeam&lt;/code&gt;) and are grouped by service area, simplifying learning and usage. (&lt;a href=&quot;https://www.lee-ford.co.uk/graph-api-powershell-sdk/?utm_source=openai&quot;&gt;lee-ford.co.uk&lt;/a&gt;)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;https://oaidalleapiprodscus.blob.core.windows.net/private/org-2h1hGiSpEV2xL1QmmetBTfNv/user-ugXgjn5iKT1karGVlJhSKvX2/img-V0XOg8NIFUgSFlFeZOhHiceE.png?st=2025-05-26T22%3A49%3A03Z&amp;amp;se=2025-05-27T00%3A49%3A03Z&amp;amp;sp=r&amp;amp;sv=2024-08-04&amp;amp;sr=b&amp;amp;rscd=inline&amp;amp;rsct=image/png&amp;amp;skoid=cc612491-d948-4d2e-9821-2683df3719f5&amp;amp;sktid=a48cca56-e6da-484e-a814-9c849652bcb3&amp;amp;skt=2025-05-26T17%3A15%3A43Z&amp;amp;ske=2025-05-27T17%3A15%3A43Z&amp;amp;sks=b&amp;amp;skv=2024-08-04&amp;amp;sig=PIxfJQ9gikE22tJdAy%2BjemCK3zZst/A0rDmna3MiQT8%3D&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;prerequisites--environment-setup&quot;&gt;Prerequisites &amp;amp; Environment Setup&lt;/h2&gt;

&lt;h3 id=&quot;installation-requirements&quot;&gt;Installation Requirements&lt;/h3&gt;

&lt;p&gt;To begin working with the Microsoft Graph PowerShell SDK, confirm that your environment meets the following requirements:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;PowerShell 5.1 or later&lt;/strong&gt;: This is the minimum version required. PowerShell Core (7+) is supported across Windows, macOS, and Linux.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;.NET Core Runtime&lt;/strong&gt;: Required for PowerShell Core usage. Ensure the appropriate version is installed based on your PowerShell version.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Microsoft 365 Tenant Access&lt;/strong&gt;: You need access to a Microsoft 365 tenant. This typically requires:
    &lt;ul&gt;
      &lt;li&gt;A Microsoft work or school account.&lt;/li&gt;
      &lt;li&gt;An Exchange Online mailbox.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;For more details on account prerequisites, refer to the &lt;a href=&quot;https://learn.microsoft.com/en-us/graph/tutorials/powershell?utm_source=openai&quot;&gt;Microsoft Graph PowerShell tutorial&lt;/a&gt;.&lt;/p&gt;

&lt;h3 id=&quot;sdk-installation&quot;&gt;SDK Installation&lt;/h3&gt;

&lt;p&gt;To install the Microsoft Graph PowerShell SDK, use the following command:&lt;/p&gt;

&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Install-Module&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Microsoft.Graph&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Scope&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;CurrentUser&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This installs the latest version of the SDK for the current user. If you encounter module name conflicts, append the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-AllowClobber&lt;/code&gt; flag:&lt;/p&gt;

&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Install-Module&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Microsoft.Graph&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Scope&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;CurrentUser&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-AllowClobber&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;For installing a specific version (e.g., version 2.x.x), use:&lt;/p&gt;

&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Install-Module&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Microsoft.Graph&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-RequiredVersion&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;2.x.x&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Version 2 of the SDK introduces a modular structure, reducing installation size and improving load performance. For a detailed overview of these improvements, see the &lt;a href=&quot;https://www.techtarget.com/searchWindowsServer/tip/Whats-new-in-Microsoft-Graph-PowerShell-v2?utm_source=openai&quot;&gt;TechTarget summary&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Once installed, verify the module is available:&lt;/p&gt;

&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Get-Module&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ListAvailable&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Microsoft.Graph&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You’re now ready to authenticate and begin making Microsoft Graph requests.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://oaidalleapiprodscus.blob.core.windows.net/private/org-2h1hGiSpEV2xL1QmmetBTfNv/user-ugXgjn5iKT1karGVlJhSKvX2/img-IYvF2dNZTj9eTLQzn3I5hJJt.png?st=2025-05-26T22%3A49%3A20Z&amp;amp;se=2025-05-27T00%3A49%3A20Z&amp;amp;sp=r&amp;amp;sv=2024-08-04&amp;amp;sr=b&amp;amp;rscd=inline&amp;amp;rsct=image/png&amp;amp;skoid=cc612491-d948-4d2e-9821-2683df3719f5&amp;amp;sktid=a48cca56-e6da-484e-a814-9c849652bcb3&amp;amp;skt=2025-05-26T11%3A47%3A39Z&amp;amp;ske=2025-05-27T11%3A47%3A39Z&amp;amp;sks=b&amp;amp;skv=2024-08-04&amp;amp;sig=xiyUuFBJN7KEJWiTEjQeifnZXq0diw4c%2BtqnlGhJWMQ%3D&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;authentication--authorization&quot;&gt;Authentication &amp;amp; Authorization&lt;/h2&gt;

&lt;h3 id=&quot;authentication-modes&quot;&gt;Authentication Modes&lt;/h3&gt;

&lt;p&gt;Microsoft Graph PowerShell SDK supports multiple authentication modes, depending on the use case. Each mode uses OAuth2 under the hood but differs in interactivity and credential flow.&lt;/p&gt;

&lt;h4 id=&quot;interactive-device-code&quot;&gt;Interactive (Device Code)&lt;/h4&gt;

&lt;p&gt;This mode is suitable for testing or running scripts manually. It prompts the user to sign in through a browser using a device code.&lt;/p&gt;

&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Connect-MgGraph&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Scopes&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;User.Read, Mail.Send&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This command initiates a device code flow and requests delegated permissions for the specified scopes.&lt;/p&gt;

&lt;h4 id=&quot;client-credential-flow&quot;&gt;Client Credential Flow&lt;/h4&gt;

&lt;p&gt;Designed for automation scenarios, this mode requires an app registration in Azure AD and uses certificates or secrets for authentication. It provides application-level access without a signed-in user.&lt;/p&gt;

&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Connect-MgGraph&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ClientId&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;app-id&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-TenantId&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;tenant-id&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-CertificateThumbprint&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;thumbprint&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This command authenticates using a certificate tied to the registered application.&lt;/p&gt;

&lt;h3 id=&quot;registering-an-app-in-azure-ad&quot;&gt;Registering an App in Azure AD&lt;/h3&gt;

&lt;p&gt;To use the client credential flow, you must register an application in Azure Active Directory:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Navigate to &lt;strong&gt;Azure Active Directory&lt;/strong&gt; in the Azure portal.&lt;/li&gt;
  &lt;li&gt;Select &lt;strong&gt;App registrations&lt;/strong&gt;, then click &lt;strong&gt;New registration&lt;/strong&gt;.&lt;/li&gt;
  &lt;li&gt;Provide a name and, if needed, specify redirect URIs.&lt;/li&gt;
  &lt;li&gt;Under &lt;strong&gt;API permissions&lt;/strong&gt;, assign required permissions:
    &lt;ul&gt;
      &lt;li&gt;&lt;strong&gt;Delegated&lt;/strong&gt; permissions for user-context operations.&lt;/li&gt;
      &lt;li&gt;&lt;strong&gt;Application&lt;/strong&gt; permissions for app-only access.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Click &lt;strong&gt;Grant admin consent&lt;/strong&gt; to finalize permission changes.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;For a detailed walkthrough, see &lt;a href=&quot;https://thesleepyadmins.com/2020/11/22/using-microsoft-graph-powershell-sdk/?utm_source=openai&quot;&gt;thesleepyadmins.com&lt;/a&gt;.&lt;/p&gt;

&lt;h3 id=&quot;token-handling&quot;&gt;Token Handling&lt;/h3&gt;

&lt;p&gt;The SDK handles OAuth2 tokens automatically. It caches tokens and refreshes them as needed, reducing manual intervention.&lt;/p&gt;

&lt;p&gt;Use the following command to inspect the current authentication context and token details:&lt;/p&gt;

&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Get-MgContext&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This reveals the current scopes, tenant, and token expiration.&lt;/p&gt;

&lt;p&gt;More information on token behavior is available at &lt;a href=&quot;https://www.lee-ford.co.uk/graph-api-powershell-sdk/?utm_source=openai&quot;&gt;lee-ford.co.uk&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://oaidalleapiprodscus.blob.core.windows.net/private/org-2h1hGiSpEV2xL1QmmetBTfNv/user-ugXgjn5iKT1karGVlJhSKvX2/img-yyIYixKb2NAP6bG66SmgbAoM.png?st=2025-05-26T22%3A49%3A37Z&amp;amp;se=2025-05-27T00%3A49%3A37Z&amp;amp;sp=r&amp;amp;sv=2024-08-04&amp;amp;sr=b&amp;amp;rscd=inline&amp;amp;rsct=image/png&amp;amp;skoid=cc612491-d948-4d2e-9821-2683df3719f5&amp;amp;sktid=a48cca56-e6da-484e-a814-9c849652bcb3&amp;amp;skt=2025-05-26T15%3A12%3A44Z&amp;amp;ske=2025-05-27T15%3A12%3A44Z&amp;amp;sks=b&amp;amp;skv=2024-08-04&amp;amp;sig=s6Pey5UHyE7Z2GIG3S6FS4Jjb4fz4TysviiKpM5rOGU%3D&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;core-concepts-cmdlet-structure-modules-and-permissions&quot;&gt;Core Concepts: Cmdlet Structure, Modules, and Permissions&lt;/h2&gt;

&lt;h3 id=&quot;cmdlet-naming-convention&quot;&gt;Cmdlet Naming Convention&lt;/h3&gt;

&lt;p&gt;Microsoft Graph PowerShell SDK cmdlets follow a consistent naming convention designed around the format:&lt;/p&gt;

&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Verb-Mg&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Resource&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;For example:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Get-MgUser&lt;/code&gt; — Retrieves a user object from Microsoft Graph.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Send-MgUserMail&lt;/code&gt; — Sends email on behalf of a user.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;To discover all available cmdlets across Microsoft Graph modules, use:&lt;/p&gt;

&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Get-Command&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Module&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Microsoft.Graph&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This command lists all cmdlets from installed Microsoft Graph modules, making it easier to explore functionality by resource.&lt;/p&gt;

&lt;h3 id=&quot;module-structure-v2&quot;&gt;Module Structure (v2+)&lt;/h3&gt;

&lt;p&gt;Starting with version 2, the Microsoft Graph PowerShell SDK is modular. Instead of installing a monolithic package, you can now install only the modules you need. This leads to smaller install footprints and faster import times.&lt;/p&gt;

&lt;p&gt;For example, to work with users:&lt;/p&gt;

&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Install-Module&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Microsoft.Graph.Users&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Import-Module&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Microsoft.Graph.Users&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This modular design improves performance and aligns with PowerShell best practices. &lt;a href=&quot;https://www.techtarget.com/searchWindowsServer/tip/Whats-new-in-Microsoft-Graph-PowerShell-v2?utm_source=openai&quot;&gt;TechTarget explains the advantages in more detail&lt;/a&gt;.&lt;/p&gt;

&lt;h3 id=&quot;permissions-model&quot;&gt;Permissions Model&lt;/h3&gt;

&lt;p&gt;Microsoft Graph enforces a robust permissions model. Cmdlets require either &lt;strong&gt;delegated&lt;/strong&gt; or &lt;strong&gt;application&lt;/strong&gt; permissions, depending on the execution context.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Delegated Permissions&lt;/strong&gt;: These run under a signed-in user’s context. They are suitable for interactive scenarios—e.g., a script run by an admin in their own session.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Application Permissions&lt;/strong&gt;: These are used in app-only contexts, such as background services or daemon processes. They require certificate-based authentication or client secrets.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;For a deeper dive into permission types and how to configure them, see &lt;a href=&quot;https://practical365.com/introduction-to-the-microsoft-graph-powershell-sdk/?utm_source=openai&quot;&gt;Practical365’s introduction&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Understanding the interplay between cmdlets, modules, and permissions is critical for building secure, maintainable scripts with the Microsoft Graph PowerShell SDK.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://oaidalleapiprodscus.blob.core.windows.net/private/org-2h1hGiSpEV2xL1QmmetBTfNv/user-ugXgjn5iKT1karGVlJhSKvX2/img-FFjn2Y5a8FqHHBqP5SEx8y9I.png?st=2025-05-26T22%3A49%3A54Z&amp;amp;se=2025-05-27T00%3A49%3A54Z&amp;amp;sp=r&amp;amp;sv=2024-08-04&amp;amp;sr=b&amp;amp;rscd=inline&amp;amp;rsct=image/png&amp;amp;skoid=cc612491-d948-4d2e-9821-2683df3719f5&amp;amp;sktid=a48cca56-e6da-484e-a814-9c849652bcb3&amp;amp;skt=2025-05-26T15%3A38%3A30Z&amp;amp;ske=2025-05-27T15%3A38%3A30Z&amp;amp;sks=b&amp;amp;skv=2024-08-04&amp;amp;sig=OkIuzKUm2OgxwgWyb5SdM/CuEpnm1bpkFi4LNsX2jgk%3D&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;hands-on-examples&quot;&gt;Hands-On Examples&lt;/h2&gt;

&lt;p&gt;The Microsoft Graph PowerShell SDK provides a PowerShell interface to the Microsoft Graph API, enabling access to Microsoft 365 data. Below are practical examples demonstrating common use cases.&lt;/p&gt;

&lt;h3 id=&quot;1-get-current-user-info&quot;&gt;1. Get Current User Info&lt;/h3&gt;

&lt;p&gt;To retrieve information about the currently signed-in user:&lt;/p&gt;

&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Connect-MgGraph&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Scopes&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;User.Read&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-MgUser&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-UserId&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;me&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-Scopes&lt;/code&gt; parameter specifies the permission scope required. &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;me&lt;/code&gt; is a special alias referring to the authenticated user.&lt;/p&gt;

&lt;h3 id=&quot;2-list-inbox-messages&quot;&gt;2. List Inbox Messages&lt;/h3&gt;

&lt;p&gt;To fetch the five most recent messages in the signed-in user’s inbox:&lt;/p&gt;

&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Get-MgUserMessage&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-UserId&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;me&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Top&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-Top&lt;/code&gt; parameter controls pagination by limiting the number of results returned.&lt;/p&gt;

&lt;h3 id=&quot;3-send-an-email&quot;&gt;3. Send an Email&lt;/h3&gt;

&lt;p&gt;To send an email from the authenticated user:&lt;/p&gt;

&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Send-MgUserMail&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-UserId&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;me&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Message&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;@{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Subject&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Demo&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Body&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;@{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ContentType&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Text&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Content&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;This is a test.&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ToRecipients&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;@(@{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;EmailAddress&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;@{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Address&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;example@domain.com&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-SaveToSentItems&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This sends a plain-text email and saves a copy in the Sent Items folder. Adjust the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ContentType&lt;/code&gt; to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;HTML&lt;/code&gt; for rich formatting.&lt;/p&gt;

&lt;h3 id=&quot;4-use-filters-and-pagination&quot;&gt;4. Use Filters and Pagination&lt;/h3&gt;

&lt;p&gt;To filter users whose display names start with “Dylan” and limit results to ten entries:&lt;/p&gt;

&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Get-MgUser&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Filter&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;startsWith(displayName,&apos;Dylan&apos;)&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Top&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This uses OData-style filtering supported by Microsoft Graph. Note that not all properties are filterable.&lt;/p&gt;

&lt;h3 id=&quot;5-schedule-a-script-with-non-interactive-auth&quot;&gt;5. Schedule a Script with Non-Interactive Auth&lt;/h3&gt;

&lt;p&gt;For automation scenarios (e.g., scripts running as scheduled tasks or background jobs), use certificate-based authentication. This avoids interactive sign-ins.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Register an Azure AD app and upload a certificate.&lt;/li&gt;
  &lt;li&gt;Use the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-CertificateThumbprint&lt;/code&gt; parameter with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Connect-MgGraph&lt;/code&gt;:&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Connect-MgGraph&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ClientId&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&amp;lt;app-id&amp;gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-TenantId&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&amp;lt;tenant-id&amp;gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-CertificateThumbprint&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&amp;lt;thumbprint&amp;gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This enables secure, unattended access—suitable for CI/CD pipelines or service accounts.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://oaidalleapiprodscus.blob.core.windows.net/private/org-2h1hGiSpEV2xL1QmmetBTfNv/user-ugXgjn5iKT1karGVlJhSKvX2/img-CKzItIxgrhkBPDDK2PL12BDQ.png?st=2025-05-26T22%3A50%3A11Z&amp;amp;se=2025-05-27T00%3A50%3A11Z&amp;amp;sp=r&amp;amp;sv=2024-08-04&amp;amp;sr=b&amp;amp;rscd=inline&amp;amp;rsct=image/png&amp;amp;skoid=cc612491-d948-4d2e-9821-2683df3719f5&amp;amp;sktid=a48cca56-e6da-484e-a814-9c849652bcb3&amp;amp;skt=2025-05-26T13%3A37%3A03Z&amp;amp;ske=2025-05-27T13%3A37%3A03Z&amp;amp;sks=b&amp;amp;skv=2024-08-04&amp;amp;sig=tNZwnejR8F8RB%2Bhk0WSjJ8jSks//45L38ZuWAp%2BME7M%3D&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;troubleshooting--best-practices&quot;&gt;Troubleshooting &amp;amp; Best Practices&lt;/h2&gt;

&lt;h3 id=&quot;common-issues&quot;&gt;Common Issues&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;Permission Denied&lt;/strong&gt;&lt;br /&gt;
This typically occurs when the signed-in user or app lacks the necessary Microsoft Graph permissions. Verify that admin consent has been granted for the required scopes. You can inspect current permissions using &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Get-MgContext&lt;/code&gt; and consult the Azure Portal to confirm role assignments.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Token Expiry&lt;/strong&gt;&lt;br /&gt;
Access tokens issued by Microsoft Identity Platform are short-lived (usually 1 hour). If you receive authentication-related errors after a time delay, re-authentication may be necessary. For long-running scripts, implement token refresh logic or use &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Connect-MgGraph&lt;/code&gt; with certificate-based authentication.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Cmdlet Not Found&lt;/strong&gt;&lt;br /&gt;
This usually indicates that the appropriate module or command set is not installed or imported. Use &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Get-Command -Module Microsoft.Graph*&lt;/code&gt; to list installed cmdlets. You can install the latest SDK modules with:&lt;/p&gt;

&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Install-Module&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Microsoft.Graph&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Scope&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;CurrentUser&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Check for specific workloads (e.g., Users, Groups) with:&lt;/p&gt;

&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Find-MgGraphCommand&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Command&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Get-MgUser&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;tips&quot;&gt;Tips&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Apply the &lt;strong&gt;principle of least privilege&lt;/strong&gt; when assigning API permissions. Grant only the scopes needed by the script or user context.&lt;/li&gt;
  &lt;li&gt;Use &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Select-MgProfile -Name beta&lt;/code&gt; to target Microsoft Graph beta endpoints. Be aware that these APIs are subject to change and not supported for production workloads.&lt;/li&gt;
  &lt;li&gt;Run &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Disconnect-MgGraph&lt;/code&gt; at the end of a session to explicitly clear authentication context, especially important when switching users or automating multiple runs.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;community--documentation&quot;&gt;Community &amp;amp; Documentation&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://learn.microsoft.com/en-us/graph/tutorials/powershell?utm_source=openai&quot;&gt;Microsoft Official Tutorial&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://thesleepyadmins.com/2020/11/22/using-microsoft-graph-powershell-sdk/?utm_source=openai&quot;&gt;TheSleepyAdmins&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://practical365.com/introduction-to-the-microsoft-graph-powershell-sdk/?utm_source=openai&quot;&gt;Practical365&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;By mastering the Microsoft Graph PowerShell SDK, IT professionals can build reliable, scalable automation for cloud-based environments—using familiar tools with enterprise-grade extensibility.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://oaidalleapiprodscus.blob.core.windows.net/private/org-2h1hGiSpEV2xL1QmmetBTfNv/user-ugXgjn5iKT1karGVlJhSKvX2/img-5WyxWo4Ty6wiFC8cZw2Qy4V2.png?st=2025-05-26T22%3A50%3A27Z&amp;amp;se=2025-05-27T00%3A50%3A27Z&amp;amp;sp=r&amp;amp;sv=2024-08-04&amp;amp;sr=b&amp;amp;rscd=inline&amp;amp;rsct=image/png&amp;amp;skoid=cc612491-d948-4d2e-9821-2683df3719f5&amp;amp;sktid=a48cca56-e6da-484e-a814-9c849652bcb3&amp;amp;skt=2025-05-26T13%3A02%3A30Z&amp;amp;ske=2025-05-27T13%3A02%3A30Z&amp;amp;sks=b&amp;amp;skv=2024-08-04&amp;amp;sig=nRy/SKFxCKht7vgXoc0f5Kukd9HvWt63%2BHPWi2XqmpE%3D&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
</description>
                <pubDate>Tue, 27 May 2025 00:00:00 -0500</pubDate>
                <link>http://localhost:4000/posts/getting-started-with-microsoft-graph-powershell-sdk</link>
                <guid isPermaLink="true">http://localhost:4000/posts/getting-started-with-microsoft-graph-powershell-sdk</guid>
                
                <category>Microsoft Graph</category>
                
                <category>PowerShell</category>
                
                <category>Automation</category>
                
                <category>Microsoft 365</category>
                
                <category>Azure AD</category>
                
                
            </item>
        
            <item>
                <title>Updating Azure Virtual Machines with Azure Update Manager</title>
                <description>&lt;h1 id=&quot;updating-azure-virtual-machines-with-azure-update-manager&quot;&gt;Updating Azure Virtual Machines with Azure Update Manager&lt;/h1&gt;

&lt;p&gt;Timely patching of virtual machines (VMs) is a cornerstone of cloud infrastructure security. With cyberattacks increasingly exploiting known software vulnerabilities, automated update management becomes not just a convenience but a necessity. Azure Update Manager provides a centralized, cross-platform solution to orchestrate updates across Azure and hybrid environments. This guide provides a comprehensive overview of configuring, deploying, and monitoring updates with Azure Update Manager—while emphasizing best practices in vulnerability patching and system availability.&lt;/p&gt;

&lt;h2 id=&quot;understanding-the-risk-landscape-and-why-patch-management-matters&quot;&gt;Understanding the Risk Landscape and Why Patch Management Matters&lt;/h2&gt;

&lt;p&gt;Patch management is a foundational element of any organization’s cybersecurity strategy. Unpatched software creates openings for attackers, and adversaries are increasingly exploiting known vulnerabilities faster and more aggressively.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;“60% of cybersecurity breaches are caused by unpatched vulnerabilities” — &lt;a href=&quot;https://gitnux.org/patch-management-statistics/?utm%5Fsource=openai&quot;&gt;Gitnux&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;the-impact-of-delayed-patching&quot;&gt;The Impact of Delayed Patching&lt;/h3&gt;

&lt;p&gt;Timeliness is critical. A significant portion of vulnerabilities are not zero-days—they are known issues for which patches already exist. The delay between patch availability and deployment provides attackers with a window of opportunity.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;42% of vulnerabilities are exploited after a patch is released&lt;/strong&gt;, indicating that attackers actively monitor patch releases and reverse-engineer fixes to craft exploits (&lt;a href=&quot;https://www.micron21.com/blog/42-of-vulnerabilities-exploited-after-patch-already-released---live-patching-helps-keep-you-secure?utm%5Fsource=openai&quot;&gt;Micron21&lt;/a&gt;).&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;32% of cyberattacks target outdated software&lt;/strong&gt;, suggesting that legacy systems and slow update cycles are high-risk vectors (&lt;a href=&quot;https://arxiv.org/abs/2505.13922?utm%5Fsource=openai&quot;&gt;arxiv.org&lt;/a&gt;).&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;the-case-for-automation&quot;&gt;The Case for Automation&lt;/h3&gt;

&lt;p&gt;Manual patching is prone to delays, inconsistencies, and errors. Automation mitigates these risks by ensuring patches are applied uniformly and quickly across environments.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Automated patching leads to up to 70% faster patch deployment&lt;/strong&gt;, significantly narrowing the attacker’s window (&lt;a href=&quot;https://gitnux.org/patch-management-statistics/?utm%5Fsource=openai&quot;&gt;Gitnux&lt;/a&gt;).&lt;/li&gt;
  &lt;li&gt;Automation also &lt;strong&gt;reduces human error&lt;/strong&gt; and &lt;strong&gt;standardizes update workflows&lt;/strong&gt;, leading to greater operational stability and compliance.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;azures-role-in-the-modern-enterprise&quot;&gt;Azure’s Role in the Modern Enterprise&lt;/h3&gt;

&lt;p&gt;Azure Update Manager provides a centralized framework for managing server updates at scale:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Centralized control of VM updates&lt;/strong&gt; across Windows and Linux platforms simplifies operational overhead.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Integration with Azure Arc&lt;/strong&gt; extends patch management capabilities to on-premises and multi-cloud environments, enabling consistent policy enforcement regardless of where workloads reside.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Together, these capabilities make Azure a strategic platform for enterprises seeking to reduce their attack surface and improve patch compliance through automation and visibility.&lt;/p&gt;

&lt;h2 id=&quot;enabling-and-configuring-azure-update-manager&quot;&gt;Enabling and Configuring Azure Update Manager&lt;/h2&gt;

&lt;h3 id=&quot;prerequisites&quot;&gt;Prerequisites&lt;/h3&gt;

&lt;p&gt;Before configuring Azure Update Manager, ensure the following prerequisites are met:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Azure VM or Arc-enabled server&lt;/strong&gt;: The target machine must be an Azure virtual machine or an on-premises/other cloud server connected via Azure Arc.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Azure Monitor Agent&lt;/strong&gt;: The Azure Monitor Agent (AMA) must be installed on each machine to collect update data and enable patching actions.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Role-Based Access Control (RBAC)&lt;/strong&gt;: The user performing configuration must have at least the &lt;strong&gt;Contributor&lt;/strong&gt; role on the target scope (subscription, resource group, or VM level). For finer control, custom roles with specific Update Management actions can be defined.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;initial-setup&quot;&gt;Initial Setup&lt;/h3&gt;

&lt;p&gt;To begin using Azure Update Manager:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Open the &lt;strong&gt;Azure Portal&lt;/strong&gt;.&lt;/li&gt;
  &lt;li&gt;Search for and navigate to &lt;strong&gt;Azure Update Manager&lt;/strong&gt;.&lt;/li&gt;
  &lt;li&gt;Select &lt;strong&gt;Machines&lt;/strong&gt; and identify the VM(s) or Arc-enabled server(s) you want to onboard.&lt;/li&gt;
  &lt;li&gt;Click &lt;strong&gt;Enable Azure Update Manager&lt;/strong&gt;. This action configures the selected machines for update management.&lt;/li&gt;
  &lt;li&gt;Review and confirm the installation of the Azure Monitor Agent if it is not already present. Machines must have AMA deployed for Update Manager to function.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;You can enable update management:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Individually&lt;/strong&gt;: Select and onboard a single VM or server.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;At scale&lt;/strong&gt;: Use Azure Policy or bulk selection to onboard multiple machines across subscriptions or resource groups.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;grouping-resources-with-update-configurations&quot;&gt;Grouping Resources with Update Configurations&lt;/h3&gt;

&lt;p&gt;Azure Update Manager allows administrators to define &lt;strong&gt;update configurations&lt;/strong&gt;, which group machines for consistent update behavior.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Scopes&lt;/strong&gt;: Define the scope of an update configuration using:&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Subscription&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Resource Group&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Tags&lt;/strong&gt; (e.g., &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Environment=Prod&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;OS=Linux&lt;/code&gt;)&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Dynamic Scoping&lt;/strong&gt;: Update configurations can use &lt;strong&gt;dynamic scoping&lt;/strong&gt;, which automatically includes new machines that match the configuration criteria (e.g., machines with a specific tag or in a particular resource group). This ensures that newly provisioned or re-tagged machines are automatically managed without manual intervention.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Example:&lt;/p&gt;

&lt;div class=&quot;language-json highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;scope&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;subscriptions&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/subscriptions/abc123&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;tags&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;Environment&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Production&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;updateSettings&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;rebootSetting&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;IfRequired&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;updateClassification&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Security&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Critical&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This configuration targets all production machines in a specific subscription and applies only security and critical updates, rebooting only if needed.&lt;/p&gt;

&lt;h2 id=&quot;assessing-vm-update-compliance-and-scheduling-deployments&quot;&gt;Assessing VM Update Compliance and Scheduling Deployments&lt;/h2&gt;

&lt;h3 id=&quot;reviewing-update-assessments&quot;&gt;Reviewing Update Assessments&lt;/h3&gt;

&lt;p&gt;To evaluate the update status of your virtual machines (VMs), use the &lt;strong&gt;Compliance&lt;/strong&gt; tab in Azure Update Manager. This view provides a breakdown of missing updates by:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Severity&lt;/strong&gt;: Highlights updates categorized as critical, important, or optional.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Type&lt;/strong&gt;: Differentiates between security, quality, and feature updates.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Age&lt;/strong&gt;: Shows how long each update has been pending.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;You can filter the compliance data based on:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Operating System (OS)&lt;/strong&gt;: Focus on specific OS families such as Windows or Linux.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Patch Classification&lt;/strong&gt;: Narrow your view by update categories like security, critical, or other.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;This allows for granular targeting of remediation efforts, especially useful for prioritizing high-risk vulnerabilities.&lt;/p&gt;

&lt;h3 id=&quot;creating-update-deployments&quot;&gt;Creating Update Deployments&lt;/h3&gt;

&lt;p&gt;Azure Update Manager supports both &lt;strong&gt;recurring&lt;/strong&gt; and &lt;strong&gt;one-time&lt;/strong&gt; update deployments. When creating a deployment, you can specify:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Patch Categories&lt;/strong&gt;: Select which types of updates to apply, such as security-only or include all quality updates.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Reboot Behavior&lt;/strong&gt;:&lt;/li&gt;
  &lt;li&gt;&lt;em&gt;Always reboot&lt;/em&gt; after updates.&lt;/li&gt;
  &lt;li&gt;&lt;em&gt;Never reboot&lt;/em&gt; (not recommended for critical patches).&lt;/li&gt;
  &lt;li&gt;&lt;em&gt;Reboot if required&lt;/em&gt; (default behavior).&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Pre/Post Scripts&lt;/strong&gt;: Define scripts to run before or after update application. This is useful for preparing workloads or validating system health post-patch.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Target machines can be selected using:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Saved Scopes&lt;/strong&gt;: Predefined groups of machines based on tags or resource groups.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Custom Queries&lt;/strong&gt;: Use Azure Resource Graph queries for dynamic targeting.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;hotpatching-and-reboot-considerations&quot;&gt;Hotpatching and Reboot Considerations&lt;/h3&gt;

&lt;p&gt;A recent enhancement to Azure Update Manager is support for &lt;strong&gt;Hotpatching&lt;/strong&gt; on &lt;strong&gt;Arc-enabled servers&lt;/strong&gt; (&lt;a href=&quot;https://learn.microsoft.com/en-us/azure/update-manager/whats-new?utm%5Fsource=openai&quot;&gt;Microsoft Docs&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;Hotpatching enables the application of critical security updates &lt;strong&gt;without requiring a reboot&lt;/strong&gt;. This is particularly beneficial in environments with strict &lt;strong&gt;Service-Level Agreements (SLAs)&lt;/strong&gt; or high availability requirements.&lt;/p&gt;

&lt;p&gt;Key considerations:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Hotpatching is currently available on specific Windows Server versions.&lt;/li&gt;
  &lt;li&gt;It significantly reduces downtime, but not all updates qualify for hotpatching.&lt;/li&gt;
  &lt;li&gt;When planning deployments, verify hotpatch eligibility to minimize disruption.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Use hotpatching in conjunction with compliance assessments and targeted deployments to implement a resilient and minimally disruptive patching strategy.&lt;/p&gt;

&lt;h2 id=&quot;monitoring-and-troubleshooting-update-deployments&quot;&gt;Monitoring and Troubleshooting Update Deployments&lt;/h2&gt;

&lt;h3 id=&quot;viewing-deployment-status&quot;&gt;Viewing Deployment Status&lt;/h3&gt;

&lt;p&gt;Azure Update Manager provides real-time visibility into update deployments across your virtual machines (VMs). From the Azure portal:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Navigate to &lt;strong&gt;Update Manager&lt;/strong&gt; &amp;gt; &lt;strong&gt;Machines&lt;/strong&gt;.&lt;/li&gt;
  &lt;li&gt;Select a target machine or deployment schedule.&lt;/li&gt;
  &lt;li&gt;View the &lt;strong&gt;Deployment status&lt;/strong&gt; tab to track update progress, including:&lt;/li&gt;
&lt;/ol&gt;

&lt;ul&gt;
  &lt;li&gt;Total number of updates installed&lt;/li&gt;
  &lt;li&gt;Updates failed or skipped&lt;/li&gt;
  &lt;li&gt;Duration and current step of each deployment&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;For more detailed insight, you can examine the &lt;strong&gt;Update logs&lt;/strong&gt; for each VM. Look specifically for:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Skipped updates&lt;/strong&gt;: Often due to prerequisites not being met or updates being superseded.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Timeouts&lt;/strong&gt;: Caused by network latency or the machine being offline.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Agent issues&lt;/strong&gt;: Such as the Azure VM agent being outdated or unresponsive. These appear as error codes in the deployment report and can be correlated with logs in the VM’s local Event Viewer.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;handling-failures&quot;&gt;Handling Failures&lt;/h3&gt;

&lt;p&gt;Deployment failures are logged automatically and can be exported for analysis. To configure this:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Go to the Update Manager settings in the Azure portal.&lt;/li&gt;
  &lt;li&gt;Under &lt;strong&gt;Diagnostic settings&lt;/strong&gt;, enable log forwarding to one or more of the following:&lt;/li&gt;
&lt;/ol&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Log Analytics&lt;/strong&gt; workspace&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Event Hub&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Azure Storage Account&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;This enables long-term storage and query-based troubleshooting using Kusto Query Language (KQL). Example KQL query to find failed patches:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-kusto&quot;&gt;UpdateSummary
| where Status == &quot;Failed&quot;
| summarize count() by Computer, UpdateClassification

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Once identified, failed patches can be:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Manually remediated&lt;/strong&gt; by logging into the affected VM and installing the update directly.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Re-deployed&lt;/strong&gt; using the original update schedule or a new targeted deployment.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;integration-with-alerts-and-automation&quot;&gt;Integration with Alerts and Automation&lt;/h3&gt;

&lt;p&gt;To ensure proactive monitoring, integrate Azure Update Manager with Azure Monitor alerts:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Define &lt;strong&gt;compliance thresholds&lt;/strong&gt;, such as a rule that triggers when less than 90% of updates are successfully installed across a VM group.&lt;/li&gt;
  &lt;li&gt;Use &lt;strong&gt;Log Analytics&lt;/strong&gt; to define a custom query and alert rule.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Example alert logic:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-kusto&quot;&gt;UpdateCompliance
| summarize complianceRate = avg(IsCompliant * 100) by TimeGenerated
| where complianceRate &amp;lt; 90

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;When an alert is triggered, you can:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Send notifications via email or SMS.&lt;/li&gt;
  &lt;li&gt;Trigger &lt;strong&gt;Logic Apps&lt;/strong&gt; for complex workflows (e.g., opening a ticket in ServiceNow).&lt;/li&gt;
  &lt;li&gt;Launch &lt;strong&gt;Azure Automation Runbooks&lt;/strong&gt; to re-initiate the failed deployment or perform diagnostics.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;This integration ensures that update compliance is continuously monitored and remediated automatically where possible.&lt;/p&gt;

&lt;h2 id=&quot;best-practices-for-update-management-at-scale&quot;&gt;Best Practices for Update Management at Scale&lt;/h2&gt;

&lt;p&gt;Effective update management across a large fleet of Azure Virtual Machines (VMs) requires consistent enforcement, monitoring, and adaptation. This section outlines best practices in three key areas: governance and compliance, continuous improvement, and hybrid or multi-cloud environments.&lt;/p&gt;

&lt;h3 id=&quot;governance-and-compliance&quot;&gt;Governance and Compliance&lt;/h3&gt;

&lt;p&gt;To maintain a secure and compliant environment, define and enforce organizational patching standards using Azure-native tools:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Enforce patching policies through Azure Policy&lt;/strong&gt;: Azure Policy offers built-in definitions like &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;DeployIfNotExists&lt;/code&gt; to ensure that VMs are configured for automatic updates or enrolled in Azure Update Manager. Custom policies can be authored to enforce OS-specific patching schedules, minimum compliance thresholds, or required reboot behaviors.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Audit update compliance via Azure Resource Graph queries&lt;/strong&gt;: Azure Resource Graph enables scalable, cross-subscription queries to evaluate patch status. Example query:&lt;/li&gt;
&lt;/ul&gt;

&lt;pre&gt;&lt;code class=&quot;language-kusto&quot;&gt;  UpdateResources
  | where UpdateState == &apos;Needed&apos;
  | summarize count() by OSName, SubscriptionId

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Use these queries to identify non-compliant VMs, stale update configurations, or missed patch windows. Integrate them into Power BI dashboards or Azure Monitor workbooks for regular reporting.&lt;/p&gt;

&lt;h3 id=&quot;continuous-improvement&quot;&gt;Continuous Improvement&lt;/h3&gt;

&lt;p&gt;Update management should not be a set-it-and-forget-it process. Implement a feedback loop to improve reliability and coverage:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Conduct monthly review of update compliance metrics&lt;/strong&gt;: Export data from Update Manager into Log Analytics or Azure Monitor. Track key indicators such as patch success rate, average deployment duration, and failure causes.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Tune deployment scopes and schedules based on failure patterns&lt;/strong&gt;: If recurring failures are localized to a region, OS version, or workload type, adjust deployment groups accordingly. For example, reschedule updates for database VMs to less disruptive hours, or stagger updates using maintenance windows to reduce concurrency-induced failures.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;hybrid-and-multi-cloud-considerations&quot;&gt;Hybrid and Multi-Cloud Considerations&lt;/h3&gt;

&lt;p&gt;In mixed environments, achieving consistent patching behavior requires extending Azure-native capabilities:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Extend Update Manager to on-prem &amp;amp; other cloud VMs with Azure Arc&lt;/strong&gt;: Azure Arc enables Update Manager support for non-Azure machines by projecting them as resource objects in Azure. This allows unified policy enforcement, update orchestration, and compliance monitoring, regardless of location.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Ensure consistent patching posture across environments&lt;/strong&gt;: Standardize tagging conventions, update classifications, and maintenance window definitions across cloud and on-premises. Use Azure Resource Graph to compare compliance rates by environment type. Configuration drift between environments often leads to security gaps or audit failures.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;By adhering to these practices, organizations can scale their update management processes with greater reliability, visibility, and security alignment.&lt;/p&gt;

&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;Automated update management with Azure Update Manager is a critical component of enterprise IT operations. It directly addresses key challenges in vulnerability management, compliance enforcement, and uptime assurance. Features such as &lt;strong&gt;hotpatching&lt;/strong&gt;—which applies patches without requiring a reboot—and &lt;strong&gt;dynamic scoping&lt;/strong&gt;—which allows targeting update deployments based on resource attributes—make it feasible to patch at scale without disrupting services.&lt;/p&gt;

&lt;p&gt;Unpatched systems continue to be among the most exploited vectors in data breaches. By adopting Azure Update Manager, organizations can systematically reduce exposure windows, enforce update baselines, and align with security best practices. In practical terms, this shifts patching from a reactive, manual process to a proactive, policy-driven workflow.&lt;/p&gt;

&lt;p&gt;The technical overhead of maintaining update compliance across hundreds or thousands of virtual machines (VMs) is non-trivial. Azure Update Manager abstracts much of this complexity, enabling teams to define, monitor, and enforce patching strategies centrally. The result is a more secure infrastructure, reduced operational risk, and measurable gains in system reliability.&lt;/p&gt;

&lt;p&gt;In short, automated patch management is no longer a best practice—it is a baseline requirement. Azure Update Manager provides the tooling to meet that requirement at enterprise scale.&lt;/p&gt;
</description>
                <pubDate>Tue, 27 May 2025 00:00:00 -0500</pubDate>
                <link>http://localhost:4000/posts/azure-update-manager</link>
                <guid isPermaLink="true">http://localhost:4000/posts/azure-update-manager</guid>
                
                <category>Azure Update Manager</category>
                
                <category>Patch Management</category>
                
                <category>Virtual Machines</category>
                
                <category>Azure Arc</category>
                
                <category>Hotpatching</category>
                
                <category>Compliance</category>
                
                <category>Automation</category>
                
                
            </item>
        
            <item>
                <title>Implementing Secure Network Infrastructure with Azure Network Security Groups (NSGs)</title>
                <description>&lt;h1 id=&quot;implementing-secure-network-infrastructure-with-azure-network-security-groups-nsgs&quot;&gt;Implementing Secure Network Infrastructure with Azure Network Security Groups (NSGs)&lt;/h1&gt;

&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;

&lt;p&gt;The modern cloud environment presents a rapidly evolving threat landscape, where attackers continuously adapt their techniques to exploit misconfigurations, exposed services, and overly permissive access controls. As organizations migrate critical workloads to the cloud, the attack surface expands, making it imperative to implement layered and proactive security measures.&lt;/p&gt;

&lt;p&gt;Despite the availability of sophisticated identity-based and behavioral security mechanisms, network-level protection remains a cornerstone of cloud security architecture. Network security controls provide deterministic enforcement points, isolating traffic and reducing the blast radius of potential compromises. In Azure, this foundational protection is implemented through &lt;strong&gt;Network Security Groups (NSGs)&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Azure NSGs act as stateful packet filters, controlling inbound and outbound traffic to Azure resources within Virtual Networks (VNets). Administrators can define granular rules based on source/destination IP addresses, ports, and protocols, thereby enforcing least-privilege access at the network layer. Whether applied at the subnet or individual network interface level, NSGs offer a lightweight yet powerful mechanism to restrict access and monitor traffic flows.&lt;/p&gt;

&lt;p&gt;The importance of this control is underscored by industry data. In 2023, 45% of companies experiencing network security incidents reported cloud servers as the point of origin (&lt;a href=&quot;https://www.atmosera.com/blog/what-are-azure-network-security-groups/?utm%5Fsource=openai&quot;&gt;Atmosera&lt;/a&gt;). This statistic highlights the necessity of implementing robust traffic filtering controls early in the cloud deployment lifecycle.&lt;/p&gt;

&lt;p&gt;By integrating NSGs into your Azure network architecture, you establish a foundational security posture that supports more advanced protective measures while reducing your exposure to common cloud-native threats.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://oaidalleapiprodscus.blob.core.windows.net/private/org-2h1hGiSpEV2xL1QmmetBTfNv/user-ugXgjn5iKT1karGVlJhSKvX2/img-fuSGAmm4GfCdDqbSeb5ISSih.png?st=2025-05-27T19%3A56%3A36Z&amp;amp;se=2025-05-27T21%3A56%3A36Z&amp;amp;sp=r&amp;amp;sv=2024-08-04&amp;amp;sr=b&amp;amp;rscd=inline&amp;amp;rsct=image/png&amp;amp;skoid=cc612491-d948-4d2e-9821-2683df3719f5&amp;amp;sktid=a48cca56-e6da-484e-a814-9c849652bcb3&amp;amp;skt=2025-05-27T15%3A49%3A33Z&amp;amp;ske=2025-05-28T15%3A49%3A33Z&amp;amp;sks=b&amp;amp;skv=2024-08-04&amp;amp;sig=2jprIK2ywy1pvOc1aj0/BSb1TXXwa5ax10/8gfp4PYQ%3D&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;azure-nsgs-core-concepts-and-architecture&quot;&gt;Azure NSGs: Core Concepts and Architecture&lt;/h2&gt;

&lt;h3 id=&quot;what-is-an-nsg&quot;&gt;What is an NSG?&lt;/h3&gt;

&lt;p&gt;A &lt;strong&gt;Network Security Group (NSG)&lt;/strong&gt; is a virtual firewall in Microsoft Azure that governs inbound and outbound traffic to networked Azure resources. It operates at the network layer and is designed to enforce &lt;strong&gt;least privilege access&lt;/strong&gt; by limiting traffic based on defined rules.&lt;/p&gt;

&lt;p&gt;NSGs can be associated with either a subnet or individual network interfaces (NICs). When associated with a subnet, the rules apply to all resources within that subnet. When associated with a NIC, the rules apply only to the specific virtual machine (VM) connected to that NIC.&lt;/p&gt;

&lt;h3 id=&quot;nsg-components&quot;&gt;NSG Components&lt;/h3&gt;

&lt;p&gt;Each NSG consists of one or more &lt;strong&gt;security rules&lt;/strong&gt;. These rules are defined using a &lt;strong&gt;5-tuple&lt;/strong&gt; model:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Source IP address&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Source port range&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Destination IP address&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Destination port range&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Protocol&lt;/strong&gt; (TCP, UDP, or * for any)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Each rule also includes a &lt;strong&gt;priority&lt;/strong&gt; value. Lower numbers indicate higher priority. Azure processes rules in ascending order of priority until it finds a match. Once a match is found, no further rules are evaluated.&lt;/p&gt;

&lt;p&gt;There are two types of rules:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Default rules&lt;/strong&gt;: Predefined by Azure to allow basic infrastructure communication (e.g., allowing VNet traffic and denying internet-sourced traffic).&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Custom rules&lt;/strong&gt;: User-defined to meet specific security and access requirements. These override default rules if they have higher priority.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;nsg-rule-evaluation-logic&quot;&gt;NSG Rule Evaluation Logic&lt;/h3&gt;

&lt;p&gt;NSGs follow a deterministic evaluation path based on the direction of traffic.&lt;/p&gt;

&lt;h4 id=&quot;inbound-traffic&quot;&gt;Inbound Traffic&lt;/h4&gt;

&lt;ol&gt;
  &lt;li&gt;NSG rules are first evaluated at the &lt;strong&gt;subnet level&lt;/strong&gt;, if an NSG is associated with the subnet.&lt;/li&gt;
  &lt;li&gt;Then, NSG rules are evaluated at the &lt;strong&gt;NIC level&lt;/strong&gt;, if an NSG is associated with the NIC.&lt;/li&gt;
&lt;/ol&gt;

&lt;h4 id=&quot;outbound-traffic&quot;&gt;Outbound Traffic&lt;/h4&gt;

&lt;ol&gt;
  &lt;li&gt;NSG rules are evaluated first at the &lt;strong&gt;NIC level&lt;/strong&gt;.&lt;/li&gt;
  &lt;li&gt;Then, NSG rules are evaluated at the &lt;strong&gt;subnet level&lt;/strong&gt;.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;If no rule matches the traffic after evaluation, Azure applies an &lt;strong&gt;implicit deny&lt;/strong&gt; rule, which drops the traffic.&lt;/p&gt;

&lt;p&gt;Reference: &lt;a href=&quot;https://learn.microsoft.com/en-us/azure/virtual-network/network-security-group-how-it-works?utm%5Fsource=openai&quot;&gt;Microsoft Learn – How Network Security Groups Filter Network Traffic&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://oaidalleapiprodscus.blob.core.windows.net/private/org-2h1hGiSpEV2xL1QmmetBTfNv/user-ugXgjn5iKT1karGVlJhSKvX2/img-274HMpCAUUi77MigRIFdf0gk.png?st=2025-05-27T19%3A56%3A56Z&amp;amp;se=2025-05-27T21%3A56%3A56Z&amp;amp;sp=r&amp;amp;sv=2024-08-04&amp;amp;sr=b&amp;amp;rscd=inline&amp;amp;rsct=image/png&amp;amp;skoid=cc612491-d948-4d2e-9821-2683df3719f5&amp;amp;sktid=a48cca56-e6da-484e-a814-9c849652bcb3&amp;amp;skt=2025-05-27T17%3A10%3A42Z&amp;amp;ske=2025-05-28T17%3A10%3A42Z&amp;amp;sks=b&amp;amp;skv=2024-08-04&amp;amp;sig=0mclIY03NO4F0U1lxOj52gkr50OeJjyqaKwk0Uu2/DE%3D&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;nsg-association-and-deployment-strategies&quot;&gt;NSG Association and Deployment Strategies&lt;/h2&gt;

&lt;h3 id=&quot;where-you-can-apply-nsgs&quot;&gt;Where You Can Apply NSGs&lt;/h3&gt;

&lt;p&gt;Azure Network Security Groups (NSGs) can be associated with two primary scopes: &lt;strong&gt;subnets&lt;/strong&gt; and &lt;strong&gt;network interfaces (NICs)&lt;/strong&gt;. Understanding the difference in scope and impact is critical for designing secure and maintainable network architectures.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Subnets&lt;/strong&gt;: Applying an NSG at the subnet level controls traffic to all resources within the subnet. This is ideal for coarse-grained access control, such as restricting external access or enforcing internal segmentation policies across a tier (e.g., all application servers).&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Network Interfaces (NICs)&lt;/strong&gt;: NSGs associated with individual NICs enable fine-grained control per virtual machine (VM). This is especially useful when specific VMs require exceptions to general subnet rules, or for implementing zero-trust-like policies within a shared subnet.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;When both a subnet-level and NIC-level NSG are associated, Azure evaluates the effective rules as the intersection of both sets—only traffic allowed by both NSGs is permitted.&lt;/p&gt;

&lt;h3 id=&quot;combining-nsgs-with-route-tables-and-application-security-groups&quot;&gt;Combining NSGs with Route Tables and Application Security Groups&lt;/h3&gt;

&lt;p&gt;NSGs are most effective when used in conjunction with other Azure network constructs:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Route Tables&lt;/strong&gt;: While NSGs control &lt;em&gt;whether&lt;/em&gt; traffic is allowed, route tables define &lt;em&gt;where&lt;/em&gt; traffic goes. For example, you might route all outbound traffic through a firewall VM, and use NSGs to ensure only traffic from trusted IP ranges reaches that VM.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Application Security Groups (ASGs)&lt;/strong&gt;: ASGs allow you to group VMs logically, independent of IP addressing or subnet boundaries. NSGs can then use ASGs as source or destination in rules, simplifying policy definition. For instance, rather than allowing traffic from a specific IP, you allow traffic from the “WebServers” ASG.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;This combination supports scalable, readable network policies, especially in environments with dynamic or autoscaling workloads.&lt;/p&gt;

&lt;h3 id=&quot;traffic-filtering-scenarios&quot;&gt;Traffic Filtering Scenarios&lt;/h3&gt;

&lt;h4 id=&quot;internet-facing-services&quot;&gt;Internet-facing Services&lt;/h4&gt;

&lt;p&gt;NSGs should be configured with a default-deny posture:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Block all inbound traffic by default.&lt;/li&gt;
  &lt;li&gt;Explicitly allow only necessary ports, such as TCP port 443 for HTTPS.&lt;/li&gt;
  &lt;li&gt;Restrict access to administrative ports like SSH (22) or RDP (3389) using IP-based allow rules. For example, permit only known management IPs to access these services (&lt;a href=&quot;https://www.corestack.io/azure-security-tools/nsg-azure/?utm%5Fsource=openai&quot;&gt;CoreStack&lt;/a&gt;).&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;internal-traffic-control&quot;&gt;Internal Traffic Control&lt;/h4&gt;

&lt;p&gt;NSGs can also be used to segment internal traffic:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Define rules that control traffic flow between application tiers, such as allowing traffic from web tier to app tier only on specific ports.&lt;/li&gt;
  &lt;li&gt;Implement &lt;strong&gt;microsegmentation&lt;/strong&gt; by using NSGs in combination with ASGs, enabling precise control over east-west traffic within the virtual network.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;network-segmentation-with-nsgs&quot;&gt;Network Segmentation with NSGs&lt;/h3&gt;

&lt;p&gt;NSGs are a key component in enforcing &lt;strong&gt;network segmentation&lt;/strong&gt;:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Isolate environments such as development, staging, and production by assigning different NSGs to their respective subnets.&lt;/li&gt;
  &lt;li&gt;Apply &lt;strong&gt;defense-in-depth&lt;/strong&gt; by layering NSGs at both subnet and NIC levels.&lt;/li&gt;
  &lt;li&gt;Follow the &lt;strong&gt;principle of least privilege&lt;/strong&gt; by allowing only explicitly required traffic and denying all else (&lt;a href=&quot;https://medium.com/%40jdahunsi5/demystifying-azure-network-security-groups-nsgs-6e417c5a458a?utm%5Fsource=openai&quot;&gt;Medium&lt;/a&gt;).&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;This layered approach reduces the attack surface and improves security posture without introducing undue operational complexity.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://oaidalleapiprodscus.blob.core.windows.net/private/org-2h1hGiSpEV2xL1QmmetBTfNv/user-ugXgjn5iKT1karGVlJhSKvX2/img-hJjQUF2OueBA6NIkI6RxpdtR.png?st=2025-05-27T19%3A57%3A20Z&amp;amp;se=2025-05-27T21%3A57%3A20Z&amp;amp;sp=r&amp;amp;sv=2024-08-04&amp;amp;sr=b&amp;amp;rscd=inline&amp;amp;rsct=image/png&amp;amp;skoid=cc612491-d948-4d2e-9821-2683df3719f5&amp;amp;sktid=a48cca56-e6da-484e-a814-9c849652bcb3&amp;amp;skt=2025-05-27T09%3A39%3A02Z&amp;amp;ske=2025-05-28T09%3A39%3A02Z&amp;amp;sks=b&amp;amp;skv=2024-08-04&amp;amp;sig=PwxsxH1Ce8wGKV9SqnwxcR3YjTk697STDjwvjCmtOH8%3D&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;operationalizing-nsgs-monitoring-analytics-and-governance&quot;&gt;Operationalizing NSGs: Monitoring, Analytics, and Governance&lt;/h2&gt;

&lt;h3 id=&quot;using-azure-nsg-analytics&quot;&gt;Using Azure NSG Analytics&lt;/h3&gt;

&lt;p&gt;Azure Network Security Groups (NSGs) generate diagnostic data that can be ingested and analyzed using native Azure tools. Azure NSG flow logs, available through Network Watcher, provide detailed insights into allowed and denied traffic flows. This data is essential for identifying traffic patterns, diagnosing misconfigurations, and improving rule effectiveness.&lt;/p&gt;

&lt;p&gt;By integrating NSG diagnostics with &lt;strong&gt;Azure Monitor&lt;/strong&gt; and &lt;strong&gt;Microsoft Defender for Cloud&lt;/strong&gt; (formerly Azure Security Center), administrators can:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Track trends in allowed vs. denied traffic to detect anomalies or policy drift.&lt;/li&gt;
  &lt;li&gt;Identify misconfigured or redundant rules that never match traffic.&lt;/li&gt;
  &lt;li&gt;Leverage prebuilt dashboards and visualizations for actionable insights (&lt;a href=&quot;https://mobilestalk.net/azure-network-security-group-analytics/?utm%5Fsource=openai&quot;&gt;MobilesTalk&lt;/a&gt;).&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;These insights support both reactive troubleshooting and proactive security posture improvement.&lt;/p&gt;

&lt;h3 id=&quot;best-practices-for-nsg-management&quot;&gt;Best Practices for NSG Management&lt;/h3&gt;

&lt;p&gt;Effective NSG governance requires rule hygiene and architectural discipline. Recommended practices include:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Deny by default; allow by exception&lt;/strong&gt;: This principle ensures that only explicitly allowed traffic is permitted.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Minimize rule count&lt;/strong&gt;: Use Application Security Groups (ASGs) and service tags to reduce rule complexity and group similar endpoints logically.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Use augmented security rules&lt;/strong&gt;: These allow for multiple IPs and ports in a single rule, simplifying configurations and improving readability (&lt;a href=&quot;https://www.corestack.io/azure-security-tools/nsg-azure/?utm%5Fsource=openai&quot;&gt;CoreStack&lt;/a&gt;).&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Document and audit&lt;/strong&gt;: Maintain up-to-date documentation of NSG rule intent and regularly audit rule sets for relevance, redundancy, and compliance.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;common-pitfalls-and-misconfigurations&quot;&gt;Common Pitfalls and Misconfigurations&lt;/h3&gt;

&lt;p&gt;Several common issues can compromise NSG effectiveness:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Overly permissive rules&lt;/strong&gt;: For example, allowing all inbound traffic (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;*&lt;/code&gt; source, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;*&lt;/code&gt; destination port) exposes workloads unnecessarily.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Incorrect rule prioritization&lt;/strong&gt;: NSG rules are processed in order of priority (lower numbers first). A misordered allow rule can override a more restrictive deny rule.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Rule conflicts between subnet and NIC levels&lt;/strong&gt;: NSGs can be applied at both levels, and the effective policy is the combination. Conflicting rules can result in unintended access or blocked traffic.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Regular validation and the use of policy-as-code strategies can mitigate these risks and support more robust governance workflows.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://oaidalleapiprodscus.blob.core.windows.net/private/org-2h1hGiSpEV2xL1QmmetBTfNv/user-ugXgjn5iKT1karGVlJhSKvX2/img-3fP4uvF1hvYBPdCb7eJizyH9.png?st=2025-05-27T19%3A57%3A38Z&amp;amp;se=2025-05-27T21%3A57%3A38Z&amp;amp;sp=r&amp;amp;sv=2024-08-04&amp;amp;sr=b&amp;amp;rscd=inline&amp;amp;rsct=image/png&amp;amp;skoid=cc612491-d948-4d2e-9821-2683df3719f5&amp;amp;sktid=a48cca56-e6da-484e-a814-9c849652bcb3&amp;amp;skt=2025-05-27T17%3A55%3A39Z&amp;amp;ske=2025-05-28T17%3A55%3A39Z&amp;amp;sks=b&amp;amp;skv=2024-08-04&amp;amp;sig=tCu9hSidhkFiTjG0xZQZFwQLsZU1r8LjGRHtfGjOMmY%3D&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;implementation-walkthroughs--next-steps&quot;&gt;Implementation Walkthroughs &amp;amp; Next Steps&lt;/h2&gt;

&lt;h3 id=&quot;step-by-step-creating--applying-an-nsg&quot;&gt;Step-by-Step: Creating &amp;amp; Applying an NSG&lt;/h3&gt;

&lt;p&gt;Implementing a Network Security Group (NSG) in Azure involves a clear sequence of tasks. The following steps assume a working familiarity with the Azure portal, Azure CLI, or infrastructure-as-code tools such as ARM templates.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;strong&gt;Define Security Rules (Least Privilege First)&lt;/strong&gt;&lt;br /&gt;
Begin by identifying your application’s traffic flows and apply the &lt;strong&gt;principle of least privilege&lt;/strong&gt;. That means only allowing traffic that’s explicitly required, and denying everything else by default. Each rule consists of:&lt;/li&gt;
&lt;/ol&gt;

&lt;ul&gt;
  &lt;li&gt;Priority (lower values = higher priority)&lt;/li&gt;
  &lt;li&gt;Source &amp;amp; destination (IP ranges, Application Security Groups (ASGs), etc)&lt;/li&gt;
  &lt;li&gt;Protocol (TCP, UDP, or * for all)&lt;/li&gt;
  &lt;li&gt;Port range&lt;/li&gt;
  &lt;li&gt;Direction (inbound or outbound)&lt;/li&gt;
  &lt;li&gt;Action (allow or deny)&lt;/li&gt;
&lt;/ul&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;strong&gt;Create NSG&lt;/strong&gt;&lt;br /&gt;
You can create an NSG using several methods:&lt;br /&gt;
&lt;strong&gt;Azure Portal:&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;ul&gt;
  &lt;li&gt;Navigate to “Network Security Groups”&lt;/li&gt;
  &lt;li&gt;Click “+ Create”&lt;/li&gt;
  &lt;li&gt;Configure the NSG name, subscription, resource group, and region&lt;br /&gt;
&lt;strong&gt;Azure CLI:&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;   az network nsg create &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
     &lt;span class=&quot;nt&quot;&gt;--resource-group&lt;/span&gt; MyResourceGroup &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
     &lt;span class=&quot;nt&quot;&gt;--name&lt;/span&gt; MyNSG &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
     &lt;span class=&quot;nt&quot;&gt;--location&lt;/span&gt; eastus

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;ARM Template:&lt;/strong&gt; Include a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Microsoft.Network/networkSecurityGroups&lt;/code&gt; resource block with rule definitions.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;strong&gt;Associate NSG to Subnet and/or NIC&lt;/strong&gt;&lt;br /&gt;
NSGs can be associated with &lt;strong&gt;subnets&lt;/strong&gt; (for all resources in the subnet) or &lt;strong&gt;Network Interface Cards (NICs)&lt;/strong&gt; (for individual VMs). The effective rules are a union of subnet-level and NIC-level NSGs.&lt;br /&gt;
Azure CLI example:&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;   az network vnet subnet update &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
     &lt;span class=&quot;nt&quot;&gt;--resource-group&lt;/span&gt; MyResourceGroup &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
     &lt;span class=&quot;nt&quot;&gt;--vnet-name&lt;/span&gt; MyVNet &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
     &lt;span class=&quot;nt&quot;&gt;--name&lt;/span&gt; MySubnet &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
     &lt;span class=&quot;nt&quot;&gt;--network-security-group&lt;/span&gt; MyNSG

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;strong&gt;Validate Rule Behavior with NSG Flow Logs&lt;/strong&gt;&lt;br /&gt;
Enable &lt;strong&gt;NSG flow logs&lt;/strong&gt; to capture traffic metadata. This helps confirm whether rules are having their intended effect.&lt;br /&gt;
Azure CLI example:&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;   az network watcher flow-log configure &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
     &lt;span class=&quot;nt&quot;&gt;--resource-group&lt;/span&gt; MyResourceGroup &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
     &lt;span class=&quot;nt&quot;&gt;--nsg&lt;/span&gt; MyNSG &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
     &lt;span class=&quot;nt&quot;&gt;--enabled&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
     &lt;span class=&quot;nt&quot;&gt;--retention&lt;/span&gt; 7 &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
     &lt;span class=&quot;nt&quot;&gt;--storage-account&lt;/span&gt; MyStorageAccount

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Use &lt;strong&gt;Azure Network Watcher&lt;/strong&gt; or third-party analytics tools to visualize and analyze flow logs.&lt;/p&gt;

&lt;h3 id=&quot;advanced-use-cases&quot;&gt;Advanced Use Cases&lt;/h3&gt;

&lt;h4 id=&quot;nsgs-with-azure-firewall&quot;&gt;NSGs with Azure Firewall&lt;/h4&gt;

&lt;p&gt;NSGs and Azure Firewall serve complementary purposes:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;NSGs&lt;/strong&gt;: Operate at the OSI network layer (Layer 3 &amp;amp; 4). Best for access control per subnet or NIC.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Azure Firewall&lt;/strong&gt;: Works at Layer 7 (application layer), enabling filtering by domain names, TLS inspection, and logging.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;In practice, NSGs restrict traffic within the virtual network, while Azure Firewall governs traffic entering and exiting the network.&lt;/p&gt;

&lt;h4 id=&quot;nsgs-in-hub-and-spoke-architectures&quot;&gt;NSGs in Hub-and-Spoke Architectures&lt;/h4&gt;

&lt;p&gt;In a &lt;strong&gt;hub-and-spoke topology&lt;/strong&gt;, NSGs are typically applied to:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;The spoke subnets, to limit lateral movement between workloads&lt;/li&gt;
  &lt;li&gt;The hub’s VPN or ExpressRoute gateway subnet, to control ingress/egress&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Use NSG rules to enforce traffic flow policies between spokes via the hub, and restrict direct spoke-to-spoke communication unless explicitly required.&lt;/p&gt;

&lt;h4 id=&quot;nsg-integration-with-azure-policy&quot;&gt;NSG Integration with Azure Policy&lt;/h4&gt;

&lt;p&gt;Azure Policy can enforce the existence of NSGs and specific rule configurations. Common scenarios include:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Ensuring all subnets have an NSG attached&lt;/li&gt;
  &lt;li&gt;Denying inbound RDP (TCP/3389) from the internet&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Example Azure Policy definition:&lt;/p&gt;

&lt;div class=&quot;language-json highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;if&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;allOf&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;field&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Microsoft.Network/virtualNetworks/subnets/networkSecurityGroup.id&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;exists&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;false&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;then&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;effect&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;deny&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;learning-resources--documentation&quot;&gt;Learning Resources &amp;amp; Documentation&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://learn.microsoft.com/en-us/azure/virtual-network/network-security-group-how-it-works?utm%5Fsource=openai&quot;&gt;Microsoft Learn&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.atmosera.com/blog/what-are-azure-network-security-groups/?utm%5Fsource=openai&quot;&gt;Atmosera NSG Overview&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://mobilestalk.net/azure-network-security-group-analytics/?utm%5Fsource=openai&quot;&gt;MobilesTalk: NSG Analytics&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.corestack.io/azure-security-tools/nsg-azure/?utm%5Fsource=openai&quot;&gt;CoreStack Security Best Practices&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
  &lt;p&gt;“Security is not a product, but a process.” — Bruce Schneier&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;img src=&quot;https://oaidalleapiprodscus.blob.core.windows.net/private/org-2h1hGiSpEV2xL1QmmetBTfNv/user-ugXgjn5iKT1karGVlJhSKvX2/img-FghSr0QOsIsFLlZRvi9Hl473.png?st=2025-05-27T19%3A57%3A57Z&amp;amp;se=2025-05-27T21%3A57%3A57Z&amp;amp;sp=r&amp;amp;sv=2024-08-04&amp;amp;sr=b&amp;amp;rscd=inline&amp;amp;rsct=image/png&amp;amp;skoid=cc612491-d948-4d2e-9821-2683df3719f5&amp;amp;sktid=a48cca56-e6da-484e-a814-9c849652bcb3&amp;amp;skt=2025-05-27T17%3A18%3A52Z&amp;amp;ske=2025-05-28T17%3A18%3A52Z&amp;amp;sks=b&amp;amp;skv=2024-08-04&amp;amp;sig=OH%2BNjw7fiXXDViOhfoW99nPCBy3PSS%2Bb1AyZgVPNWbE%3D&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
</description>
                <pubDate>Mon, 26 May 2025 00:00:00 -0500</pubDate>
                <link>http://localhost:4000/posts/azure-network-security-groups</link>
                <guid isPermaLink="true">http://localhost:4000/posts/azure-network-security-groups</guid>
                
                <category>Azure</category>
                
                <category>Network Security</category>
                
                <category>NSG</category>
                
                <category>Cloud Security</category>
                
                <category>Infrastructure</category>
                
                <category>Zero Trust</category>
                
                <category>Monitoring</category>
                
                
            </item>
        
            <item>
                <title>Streamlining Credential Management in Azure AD App Registrations</title>
                <description>&lt;p&gt;Organizations leveraging Azure AD App Registrations rely heavily on client secrets and certificates for secure authentication between applications and services. However, these credentials have expiration dates that, if left unchecked, can lead to service outages, security risks, and administrative burden.&lt;/p&gt;

&lt;p&gt;Manually tracking the expiration of these secrets and certificates introduces significant operational overhead, especially in large enterprises where there may be hundreds or thousands of app registrations. Administrators must:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Regularly review each app registration in Azure AD.&lt;/li&gt;
  &lt;li&gt;Identify expiring secrets and certificates in a timely manner.&lt;/li&gt;
  &lt;li&gt;Notify relevant teams to update credentials before expiration.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Failure to proactively manage these expirations can result in:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Application downtime due to expired authentication credentials.&lt;/li&gt;
  &lt;li&gt;Security vulnerabilities caused by outdated secrets lingering in production environments.&lt;/li&gt;
  &lt;li&gt;Increased workload for IT teams responding to last-minute failures.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;To mitigate these risks, organizations need an automated solution that continuously monitors Azure AD secrets and certificates, providing timely notifications.&lt;/p&gt;

&lt;h2 id=&quot;automating-expiration-monitoring-with-microsoft-graph-powershell-sdk&quot;&gt;Automating Expiration Monitoring with Microsoft Graph PowerShell SDK&lt;/h2&gt;

&lt;p&gt;A more scalable approach to tracking app secrets and certificates involves leveraging the Microsoft Graph PowerShell SDK. With a PowerShell script, we can:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Connect to Microsoft Graph.&lt;/li&gt;
  &lt;li&gt;Retrieve all Azure AD App Registrations.&lt;/li&gt;
  &lt;li&gt;Identify secrets and certificates that are nearing expiration.&lt;/li&gt;
  &lt;li&gt;Send an automated email notification with a summary of expiring credentials.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;understanding-the-powershell-script&quot;&gt;Understanding the PowerShell Script&lt;/h2&gt;

&lt;p&gt;This script automates the expiration tracking process and includes key functionalities:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Connects to Microsoft Graph API using a provided Tenant ID, Client ID, and Client Secret.&lt;/li&gt;
  &lt;li&gt;Retrieves all Azure AD App Registrations.&lt;/li&gt;
  &lt;li&gt;Extracts all secrets and certificates from the applications.&lt;/li&gt;
  &lt;li&gt;Filters out expired or soon-to-expire credentials, based on a user-defined threshold (e.g., 30 days).&lt;/li&gt;
  &lt;li&gt;Formats the data into a readable table.&lt;/li&gt;
  &lt;li&gt;Sends an email notification to administrators with the expiration details.&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;how-the-script-works&quot;&gt;How the Script Works&lt;/h2&gt;

&lt;h3 id=&quot;1-defining-parameters&quot;&gt;1. Defining Parameters&lt;/h3&gt;

&lt;p&gt;The script accepts key parameters to customize execution:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;$DaysToCheck – Specifies how many days ahead to look for expiring credentials.&lt;/li&gt;
  &lt;li&gt;$SendEmail – A switch to enable email notifications.&lt;/li&gt;
  &lt;li&gt;$EmailTo – The recipient email address for notifications.&lt;/li&gt;
  &lt;li&gt;$EmailFrom – The sender’s email (UPN or Object ID).&lt;/li&gt;
  &lt;li&gt;$TenantId, $ClientId, $ClientSecret – Used to authenticate against Microsoft Graph.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;2-connecting-to-microsoft-graph&quot;&gt;2. Connecting to Microsoft Graph&lt;/h3&gt;

&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Connect-MgGraph&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-TenantId&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$TenantId&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ClientId&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ClientId&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ClientSecret&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ClientSecret&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This command authenticates to Microsoft Graph with the necessary permissions to read App Registration details.&lt;/p&gt;

&lt;h3 id=&quot;3-retrieving-azure-ad-app-registrations&quot;&gt;3. Retrieving Azure AD App Registrations&lt;/h3&gt;

&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$appRegistrations&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-MgApplication&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This retrieves all applications registered in Azure AD.&lt;/p&gt;

&lt;h3 id=&quot;4-extracting-expiring-secrets-and-certificates&quot;&gt;4. Extracting Expiring Secrets and Certificates&lt;/h3&gt;

&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kr&quot;&gt;foreach&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$app&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;in&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$AppRegistrations&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$certs&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$app&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;KeyCredentials&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$secrets&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$app&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;PasswordCredentials&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This filters client secrets that are expiring within the specified timeframe.&lt;/p&gt;

&lt;h3 id=&quot;5-sending-an-email-notification&quot;&gt;5. Sending an Email Notification&lt;/h3&gt;

&lt;p&gt;If the $SendEmail flag is enabled, the script formats the expiring credentials into an email-friendly format and sends a notification using Microsoft Graph’s email API:&lt;/p&gt;

&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kr&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Send email using Microsoft Graph&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Send-MgUserMail&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-UserId&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$From&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-BodyParameter&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$params&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Output&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Email notification sent successfully using Microsoft Graph.&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;sample-email-output&quot;&gt;Sample Email Output&lt;/h2&gt;

&lt;p&gt;When the script detects an expiring credential, it generates an email similar to this:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;h3 id=&quot;subject-azure-ad-app-registration---expiring-certificates-and-secrets&quot;&gt;Subject: Azure AD App Registration - Expiring Certificates and Secrets&lt;/h3&gt;

  &lt;h4 id=&quot;the-following-certificates-and-secrets-will-expire-within-the-next-30-days&quot;&gt;The following certificates and secrets will expire within the next 30 days:&lt;/h4&gt;

  &lt;table&gt;
    &lt;thead&gt;
      &lt;tr&gt;
        &lt;th&gt;App Name&lt;/th&gt;
        &lt;th&gt;App ID&lt;/th&gt;
        &lt;th&gt;Type&lt;/th&gt;
        &lt;th&gt;Expiry Date&lt;/th&gt;
        &lt;th&gt;Days Remaining&lt;/th&gt;
      &lt;/tr&gt;
    &lt;/thead&gt;
    &lt;tbody&gt;
      &lt;tr&gt;
        &lt;td&gt;AppOne&lt;/td&gt;
        &lt;td&gt;12345678-ABCD&lt;/td&gt;
        &lt;td&gt;Certificate&lt;/td&gt;
        &lt;td&gt;2024-08-15&lt;/td&gt;
        &lt;td&gt;15&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td&gt;AppTwo&lt;/td&gt;
        &lt;td&gt;87654321-DCBA&lt;/td&gt;
        &lt;td&gt;Secret&lt;/td&gt;
        &lt;td&gt;2024-08-20&lt;/td&gt;
        &lt;td&gt;20&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td&gt;AppThree&lt;/td&gt;
        &lt;td&gt;11223344-EFGH&lt;/td&gt;
        &lt;td&gt;Certificate&lt;/td&gt;
        &lt;td&gt;2024-08-29&lt;/td&gt;
        &lt;td&gt;29&lt;/td&gt;
      &lt;/tr&gt;
    &lt;/tbody&gt;
  &lt;/table&gt;

  &lt;h5 id=&quot;please-take-action-to-renew-these-items-before-they-expire&quot;&gt;Please take action to renew these items before they expire.&lt;/h5&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;here-is-the-powershell-script&quot;&gt;Here is the PowerShell Script&lt;/h2&gt;

&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kr&quot;&gt;param&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Parameter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Mandatory&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$DaysToCheck&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;30&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Parameter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Mandatory&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;switch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$SendEmail&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Parameter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Mandatory&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$EmailTo&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&amp;lt;RecipientEmail&amp;gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Parameter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Mandatory&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$EmailFrom&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&amp;lt;SenderEmail&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Parameter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Mandatory&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$TenantId&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&amp;lt;TenantID&amp;gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Parameter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Mandatory&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$AppId&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&amp;lt;ApplicationClientID&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Parameter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Mandatory&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ClientSecret&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&amp;lt;ApplicationSecretValue&amp;gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Connect-ToMicrosoftGraph&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;param&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Parameter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Mandatory&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$TenantId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Parameter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Mandatory&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ClientId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Parameter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Mandatory&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ClientSecret&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

    &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IsNullOrEmpty&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$TenantId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-or&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IsNullOrEmpty&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ClientId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-or&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IsNullOrEmpty&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ClientSecret&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# For Azure Automation, use Managed Identity&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Connect-MgGraph&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Identity&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Scopes&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Application.Read.All&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Mail.Send&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Output&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Successfully connected to Microsoft Graph using Managed Identity.&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Use client credentials flow&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$SecureSecret&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ConvertTo-SecureString&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-String&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ClientSecret&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-AsPlainText&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Force&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ClientSecretCredential&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;New-Object&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-TypeName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;System.Management.Automation.PSCredential&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ArgumentList&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ClientId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$SecureSecret&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Connect-MgGraph&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-TenantId&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$TenantId&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ClientSecretCredential&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ClientSecretCredential&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Output&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Successfully connected to Microsoft Graph using Client Credentials.&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;catch&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Error&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Failed to connect to Microsoft Graph: &lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$_&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;throw&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Get-AppRegistrations&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$appRegistrations&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-MgApplication&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Write-Output&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Retrieved &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$appRegistrations&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Count&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; app registrations.&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$appRegistrations&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;catch&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Error&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Failed to retrieve app registrations: &lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$_&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;throw&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Get-ExpiringItems&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;param&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Parameter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Mandatory&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]]&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$AppRegistrations&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Parameter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Mandatory&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;datetime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ExpirationDate&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

    &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$expiringItems&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;@()&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

    &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;foreach&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$app&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;in&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$AppRegistrations&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$certs&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$app&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;KeyCredentials&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$secrets&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$app&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;PasswordCredentials&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

        &lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Check certificates&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;foreach&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$cert&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;in&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$certs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$cert&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;EndDateTime&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-lt&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ExpirationDate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$expiringItems&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PSCustomObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]@{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                    &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;AppName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$app&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;DisplayName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                    &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;AppId&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$app&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;AppId&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                    &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Type&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Certificate&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                    &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ExpiryDate&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$cert&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;EndDateTime&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                    &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;DaysRemaining&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;math&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Floor&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$cert&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;EndDateTime&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Get&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Date&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;)).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;TotalDays&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

        &lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Check secrets&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;foreach&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$secret&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;in&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$secrets&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$secret&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;EndDateTime&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-lt&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ExpirationDate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$expiringItems&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PSCustomObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]@{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                    &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;AppName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$app&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;DisplayName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                    &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;AppId&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$app&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;AppId&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                    &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Type&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Secret&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                    &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ExpiryDate&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$secret&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;EndDateTime&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                    &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;DaysRemaining&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;math&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Floor&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$secret&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;EndDateTime&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Get&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Date&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;)).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;TotalDays&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

    &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$expiringItems&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Send-GraphEmail&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;param&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Parameter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Mandatory&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]]&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ExpiringItems&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Parameter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Mandatory&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$To&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Parameter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Mandatory&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$From&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

    &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$subject&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Azure AD App Registration - Expiring Certificates and Secrets Alert&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

    &lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Create HTML table content&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$tableRows&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;foreach&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$item&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;in&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ExpiringItems&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$tableRows&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;@&quot;
&amp;lt;tr&amp;gt;
    &amp;lt;td style=&apos;padding:8px;border:1px solid #ddd;&apos;&amp;gt;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$item&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;AppName&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;&amp;lt;/td&amp;gt;
    &amp;lt;td style=&apos;padding:8px;border:1px solid #ddd;&apos;&amp;gt;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$item&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;AppId&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;&amp;lt;/td&amp;gt;
    &amp;lt;td style=&apos;padding:8px;border:1px solid #ddd;&apos;&amp;gt;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$item&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Type&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;&amp;lt;/td&amp;gt;
    &amp;lt;td style=&apos;padding:8px;border:1px solid #ddd;&apos;&amp;gt;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$item&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ExpiryDate&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;&amp;lt;/td&amp;gt;
    &amp;lt;td style=&apos;padding:8px;border:1px solid #ddd;&apos;&amp;gt;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$item&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;DaysRemaining&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;&amp;lt;/td&amp;gt;
&amp;lt;/tr&amp;gt;
&quot;@&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

    &lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Complete HTML body&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$htmlContent&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;@&quot;
&amp;lt;h2&amp;gt;Azure AD App Registration - Expiring Certificates and Secrets&amp;lt;/h2&amp;gt;
&amp;lt;p&amp;gt;The following certificates and secrets will expire within the next &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$DaysToCheck&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt; days:&amp;lt;/p&amp;gt;
&amp;lt;table style=&apos;border-collapse:collapse;width:100%;border:1px solid #ddd;&apos;&amp;gt;
    &amp;lt;tr style=&apos;background-color:#f2f2f2;&apos;&amp;gt;
        &amp;lt;th style=&apos;padding:8px;border:1px solid #ddd;&apos;&amp;gt;App Name&amp;lt;/th&amp;gt;
        &amp;lt;th style=&apos;padding:8px;border:1px solid #ddd;&apos;&amp;gt;App ID&amp;lt;/th&amp;gt;
        &amp;lt;th style=&apos;padding:8px;border:1px solid #ddd;&apos;&amp;gt;Type&amp;lt;/th&amp;gt;
        &amp;lt;th style=&apos;padding:8px;border:1px solid #ddd;&apos;&amp;gt;Expiry Date&amp;lt;/th&amp;gt;
        &amp;lt;th style=&apos;padding:8px;border:1px solid #ddd;&apos;&amp;gt;Days Remaining&amp;lt;/th&amp;gt;
    &amp;lt;/tr&amp;gt;
    &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$tableRows&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;
&amp;lt;/table&amp;gt;
&amp;lt;p&amp;gt;Please take action to renew these items before they expire.&amp;lt;/p&amp;gt;
&quot;@&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

    &lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Create email parameters for Microsoft Graph&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$params&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;@{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;@{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;subject&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$subject&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;@{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;contentType&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;HTML&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$htmlContent&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;toRecipients&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;@(&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;@{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                    &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;emailAddress&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;@{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                        &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;address&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$To&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;saveToSentItems&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;true&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

    &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Send email using Microsoft Graph&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Send-MgUserMail&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-UserId&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$From&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-BodyParameter&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$params&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Output&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Email notification sent successfully using Microsoft Graph.&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;catch&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Error&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Failed to send email notification through Microsoft Graph: &lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$_&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Main Script Execution&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Connect to Microsoft Graph with appropriate credentials&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Connect-ToMicrosoftGraph&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-TenantId&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$TenantId&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ClientId&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$AppId&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ClientSecret&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ClientSecret&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

    &lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Calculate expiration date&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$expirationDate&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-Date&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;AddDays&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$DaysToCheck&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Write-Output&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Checking for items expiring before: &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$expirationDate&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

    &lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Get all App Registrations&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$appRegistrations&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-AppRegistrations&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

    &lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Get expiring items&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$expiringItems&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-ExpiringItems&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-AppRegistrations&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$appRegistrations&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ExpirationDate&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$expirationDate&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

    &lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Output results&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$expiringItems&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Count&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-eq&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Output&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;No certificates or secrets are expiring within the next &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$DaysToCheck&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; days.&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Output&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Found &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$expiringItems&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Count&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; expiring items:&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$expiringItems&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Sort-Object&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Property&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;DaysRemaining&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Format-Table&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Property&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;AppName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ExpiryDate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;DaysRemaining&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-AutoSize&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;


        &lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Send email notification if enabled&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$sendEmail&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$true&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$SendEmail&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-and&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-not&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IsNullOrEmpty&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$EmailTo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-and&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-not&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IsNullOrEmpty&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$EmailFrom&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Send-GraphEmail&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ExpiringItems&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$expiringItems&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-To&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$EmailTo&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-From&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$EmailFrom&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;catch&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Error&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;An error occurred during script execution: &lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$_&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;finally&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Disconnect from Microsoft Graph&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Disconnect-MgGraph&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Write-Output&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Disconnected from Microsoft Graph.&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h1&gt;

&lt;p&gt;Manually tracking Azure AD App Registration secrets and certificates is not scalable for enterprise environments. By leveraging Microsoft Graph PowerShell SDK, administrators can:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Automate expiration monitoring.&lt;/li&gt;
  &lt;li&gt;Reduce operational overhead.&lt;/li&gt;
  &lt;li&gt;Ensure proactive notifications to prevent outages.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;This script provides a robust solution to managing Azure AD credentials efficiently, ensuring security and continuity in enterprise environments. Consider scheduling this script as a daily or weekly automation using Azure Automation or a scheduled task to keep your environment secure.&lt;/p&gt;
</description>
                <pubDate>Wed, 19 Feb 2025 05:50:00 -0600</pubDate>
                <link>http://localhost:4000/posts/steamlining-credential-management-for-azure-ad-apps</link>
                <guid isPermaLink="true">http://localhost:4000/posts/steamlining-credential-management-for-azure-ad-apps</guid>
                
                <category>Administration</category>
                
                <category>Microsoft Graph</category>
                
                <category>Azure AD</category>
                
                <category>Entra</category>
                
                
            </item>
        
            <item>
                <title>Introducing Azure Network Security Perimeter</title>
                <description>&lt;p&gt;As organizations continue their migration to the cloud, securing the digital estate becomes increasingly complex. Microsoft’s new Azure Network Security Perimeter is designed to address these challenges by providing a unified, policy-driven approach to isolate and protect resources. In this article, we explore what the network security perimeter is, how it differs from existing Azure network security tools, its relationship to Private Endpoints, and provide an example of deploying it in an existing environment.&lt;/p&gt;

&lt;h2 id=&quot;what-is-the-azure-network-security-perimeter&quot;&gt;What Is the Azure Network Security Perimeter?&lt;/h2&gt;

&lt;p&gt;The Azure Network Security Perimeter is a new security construct that allows you to define a clear boundary around your cloud resources. It implements a zero-trust security model by ensuring that only explicitly permitted traffic can enter or leave the designated perimeter. Key characteristics include:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Policy-Driven Isolation: Rather than managing disparate rules across multiple network security groups (NSGs) or firewalls, you define a centralized set of policies that govern ingress and egress traffic.&lt;/li&gt;
  &lt;li&gt;Integrated Protection: Leveraging underlying Azure backbone services, the perimeter integrates with Azure Firewall, NSGs, and threat detection tools (such as Azure Sentinel) to offer comprehensive security.&lt;/li&gt;
  &lt;li&gt;Consistent Enforcement: The perimeter provides consistent, end-to-end protection across multiple resource types, whether they’re virtual machines, databases, or PaaS services, ensuring that all resources within the boundary adhere to the same security posture.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;how-it-differs-from-existing-azure-network-security-tools&quot;&gt;How It Differs from Existing Azure Network Security Tools&lt;/h2&gt;

&lt;p&gt;Azure has long offered various tools to secure networks, including NSGs, Azure Firewall, and Application Gateway. However, the network security perimeter introduces several improvements:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Unified Security Model: Instead of managing separate configurations for different services, the perimeter unifies security enforcement. This reduces complexity and the potential for misconfigurations.&lt;/li&gt;
  &lt;li&gt;Scope and Granularity: Traditional NSGs and firewalls operate at the subnet or resource level. The network security perimeter works across an entire defined boundary, allowing you to protect multiple resource groups or virtual networks under a single umbrella.&lt;/li&gt;
  &lt;li&gt;Dynamic Policy Enforcement: Built with modern cloud architectures in mind, the perimeter dynamically applies security policies as resources scale or change, ensuring continuous compliance without manual intervention.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/images/Workstation-1.jpg&quot; alt=&quot;Computer&quot; /&gt;
&lt;em&gt;Photo by &lt;a href=&quot;https://unsplash.com/@domenicoloia&quot;&gt;Domenico Loia&lt;/a&gt; on &lt;a href=&quot;https://unsplash.com&quot;&gt;Unsplash&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;

&lt;h2 id=&quot;comparison-with-private-endpoints&quot;&gt;Comparison with Private Endpoints&lt;/h2&gt;

&lt;p&gt;Both Azure Private Endpoints and the network security perimeter aim to reduce exposure to the public internet, but they do so in different ways:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Private Endpoints:
    &lt;ul&gt;
      &lt;li&gt;Focus: Enable secure, private connectivity to specific PaaS services (like Azure Storage, SQL Database, etc.) by mapping them into your virtual network.&lt;/li&gt;
      &lt;li&gt;Use Case: Ideal for connecting individual services without routing traffic over the public internet.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Network Security Perimeter:
    &lt;ul&gt;
      &lt;li&gt;Focus: Provides a broad, overarching security boundary for a collection of resources, whether or not they are using private endpoints.&lt;/li&gt;
      &lt;li&gt;Use Case: Best suited for scenarios where you need to enforce a consistent set of policies across a wide array of services, integrating both IaaS and PaaS, and ensuring that only approved traffic can cross the boundary.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;While Private Endpoints secure the connectivity of specific services, the network security perimeter offers holistic protection by defining an entire zone of trust—ensuring that all resources within that zone adhere to the same strict access policies.&lt;/p&gt;

&lt;h2 id=&quot;deploying-the-network-security-perimeter-in-an-existing-azure-environment&quot;&gt;Deploying the Network Security Perimeter in an Existing Azure Environment&lt;/h2&gt;

&lt;p&gt;Let’s walk through an example of how to deploy the network security perimeter using Azure CLI. In this scenario, assume you have an existing resource group (MyResourceGroup) and virtual network (MyVNet).&lt;/p&gt;

&lt;h3 id=&quot;step-1-define-your-allowed-and-denied-ip-ranges&quot;&gt;Step 1: Define Your Allowed and Denied IP Ranges&lt;/h3&gt;

&lt;p&gt;Decide which IP ranges should have access to the resources inside your perimeter. For example, you might allow internal corporate IPs while denying all others by default.&lt;/p&gt;

&lt;h3 id=&quot;step-2-create-the-network-security-perimeter&quot;&gt;Step 2: Create the Network Security Perimeter&lt;/h3&gt;

&lt;p&gt;Using Azure CLI, you can create a perimeter resource and attach it to your virtual network. Below is a hypothetical command (note that the exact CLI syntax may evolve; refer to the latest Microsoft documentation for current details):&lt;/p&gt;

&lt;p&gt;In Bash&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;az network security-perimeter create &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;--name&lt;/span&gt; MySecurityPerimeter &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;--resource-group&lt;/span&gt; MyResourceGroup &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;--vnet&lt;/span&gt; MyVNet &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;--allowed-ip-ranges&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;10.1.0.0/16,192.168.1.0/24&quot;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;--default-action&lt;/span&gt; Deny
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;step-3-associate-resources-with-the-perimeter&quot;&gt;Step 3: Associate Resources with the Perimeter&lt;/h3&gt;

&lt;p&gt;Once the perimeter is in place, you need to ensure that your resources (such as VMs, databases, and other services) are tagged or associated with the perimeter. This might be done via ARM templates or additional CLI commands. For example:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;az resource update &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;--ids&lt;/span&gt; /subscriptions/&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;sub-id&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;/resourceGroups/MyResourceGroup/providers/Microsoft.Compute/virtualMachines/MyVM &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;--set&lt;/span&gt; properties.networkSecurityPerimeterId&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/subscriptions/{sub-id}/resourceGroups/MyResourceGroup/providers/Microsoft.Network/securityPerimeters/MySecurityPerimeter&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;step-4-monitor-and-adjust-policies&quot;&gt;Step 4: Monitor and Adjust Policies&lt;/h3&gt;

&lt;p&gt;After deployment, continuously monitor network traffic and review logs using Azure Monitor and Azure Sentinel. Adjust your allowed and denied rules as needed to respond to evolving threats or changes in your environment.&lt;/p&gt;

&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;The Azure Network Security Perimeter represents a significant step forward in cloud security by providing a comprehensive, policy-driven approach to protect your resources. By unifying network security controls, it simplifies management compared to traditional tools while offering enhanced protection—complementing solutions like Private Endpoints. As organizations continue to adopt cloud-first strategies, this new perimeter model is set to become a cornerstone of Azure security best practices.&lt;/p&gt;

&lt;p&gt;For the latest syntax, features, and best practices, always refer to the official Microsoft documentation on Azure Network Security Perimeter.&lt;/p&gt;
</description>
                <pubDate>Mon, 10 Feb 2025 06:01:35 -0600</pubDate>
                <link>http://localhost:4000/posts/introducing-azure-network-security-perimeter</link>
                <guid isPermaLink="true">http://localhost:4000/posts/introducing-azure-network-security-perimeter</guid>
                
                <category>Security</category>
                
                <category>New Features</category>
                
                <category>Virtual Networks</category>
                
                
            </item>
        
            <item>
                <title>Deploying Cloud PKI</title>
                <description>&lt;h2 id=&quot;the-challenges-of-on-premises-certificate-management&quot;&gt;The Challenges of On-Premises Certificate Management&lt;/h2&gt;

&lt;p&gt;Managing on-premises Certificate Authorities (CAs) has become increasingly challenging in today’s IT environment. Traditional systems demand extensive hardware, software, and administrative resources to ensure high availability and security. As organizations shift toward hybrid and cloud-first strategies, extending certificate services to remote devices adds complexity, often leading to inefficiencies and vulnerabilities. Maintaining these legacy systems can strain IT teams and limit their ability to address other critical business needs.&lt;/p&gt;

&lt;p&gt;Intune’s Cloud Public Key Infrastructure (PKI) offers a modern solution by streamlining certificate management through Microsoft’s trusted cloud infrastructure. This approach reduces overhead, enhances scalability, and improves security while simplifying certificate deployment across devices. By eliminating the need for physical hardware and complex configurations, Intune’s PKI empowers organizations to focus on their core objectives, making certificate provisioning efficient and secure.&lt;/p&gt;

&lt;h3 id=&quot;creating-a-root-ca-in-cloud-pki&quot;&gt;Creating a Root CA in Cloud PKI&lt;/h3&gt;

&lt;p&gt;The first step in deploying Intune’s Cloud PKI is creating the Root and Issuing Certificate Authorities. When it comes to setting up the CA hierarchy, you can either BYOCA (Bring Your Own CA) or set up the Root CA directly within your Intune instance. For simplicity, we will be setting up the latter solution.&lt;/p&gt;

&lt;p&gt;To begin, navigate to the Intune admin center and select Tenant Administration &amp;gt; Cloud PKI. From here, you can start configuring the Root Certificate Authority. Click on “Create” and select the Root CA option. Now specify the required settings such as certificate name, validity period, the extended key usage, and the subject attributes.&lt;/p&gt;

&lt;div class=&quot;gallery-box&quot;&gt;
  &lt;div class=&quot;gallery&quot;&gt;
    &lt;img src=&quot;/images/CloudPKI-01.jpg&quot; loading=&quot;lazy&quot; alt=&quot;Post&quot; /&gt;
    &lt;img src=&quot;/images/CloudPKI-02.jpg&quot; loading=&quot;lazy&quot; alt=&quot;Post&quot; /&gt;
    &lt;img src=&quot;/images/CloudPKI-24.jpg&quot; loading=&quot;lazy&quot; alt=&quot;Post&quot; /&gt;
    &lt;img src=&quot;/images/CloudPKI-23.jpg&quot; loading=&quot;lazy&quot; alt=&quot;Post&quot; /&gt;
    &lt;img src=&quot;/images/CloudPKI-22.jpg&quot; loading=&quot;lazy&quot; alt=&quot;Post&quot; /&gt;
    &lt;img src=&quot;/images/CloudPKI-14.jpg&quot; loading=&quot;lazy&quot; alt=&quot;Post&quot; /&gt;
  &lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;Make sure to include any EKU’s (Extended Key Usages) in the root CA that you are wanting to be made available to the issuing CA. Also keep in mind that Cloud PKI doesn’t support the “Any Purpose” EKU for their PKI’s. Once the Root CA is setup we will use it as the trust anchor for your PKI infrastructure. Once the CA is created select the CA and validate the Properties are what you are expecting. Make sure to download the Root CA from here as we will need it later.&lt;/p&gt;

&lt;div class=&quot;gallery-box&quot;&gt;
  &lt;div class=&quot;gallery&quot;&gt;
    &lt;img src=&quot;/images/CloudPKI-14.jpg&quot; loading=&quot;lazy&quot; alt=&quot;Post&quot; /&gt;
  &lt;/div&gt;
&lt;/div&gt;

&lt;h3 id=&quot;configuring-an-issuing-ca-in-cloud-pki&quot;&gt;Configuring an Issuing CA in Cloud PKI&lt;/h3&gt;

&lt;p&gt;After establishing the Root CA, the next step is to configure the Issuing CA, which handles the actual certificate issuance for devices and users. In the Intune admin center, navigate back to Tenant Administration &amp;gt; Cloud PKI and select the option to create an Issuing CA. Provide a meaningful name for the Issuing CA and link it to the previously configured Root CA. Define the certificate template settings, including key usages, validity periods, and subject attributes specific to your organization’s needs. Ensure the Issuing CA is configured to include any EKUs required for the intended certificate purposes.&lt;/p&gt;

&lt;div class=&quot;gallery-box&quot;&gt;
  &lt;div class=&quot;gallery&quot;&gt;
    &lt;img src=&quot;/images/CloudPKI-21.jpg&quot; loading=&quot;lazy&quot; alt=&quot;Post&quot; /&gt;
    &lt;img src=&quot;/images/CloudPKI-20.jpg&quot; loading=&quot;lazy&quot; alt=&quot;Post&quot; /&gt;
    &lt;img src=&quot;/images/CloudPKI-19.jpg&quot; loading=&quot;lazy&quot; alt=&quot;Post&quot; /&gt;
    &lt;img src=&quot;/images/CloudPKI-18.jpg&quot; loading=&quot;lazy&quot; alt=&quot;Post&quot; /&gt;
    &lt;img src=&quot;/images/CloudPKI-17.jpg&quot; loading=&quot;lazy&quot; alt=&quot;Post&quot; /&gt;
  &lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;Once complete, the Issuing CA will be ready to distribute certificates based on the defined templates, streamlining secure certificate deployment across your device fleet. Again download the CA here for the next step.&lt;/p&gt;

&lt;div class=&quot;gallery-box&quot;&gt;
  &lt;div class=&quot;gallery&quot;&gt;
    &lt;img src=&quot;/images/CloudPKI-16.jpg&quot; loading=&quot;lazy&quot; alt=&quot;Post&quot; /&gt;
  &lt;/div&gt;
&lt;/div&gt;

&lt;h3 id=&quot;creating-windows-configuration-profiles-for-trusted-certificates&quot;&gt;Creating Windows Configuration Profiles for Trusted Certificates&lt;/h3&gt;

&lt;p&gt;Once the Root and Issuing CAs are configured, the next step is to deploy trusted certificates to Windows devices using Intune configuration profiles. Begin by navigating to the Intune admin center and selecting Devices &amp;gt; Configuration profiles &amp;gt; Create profile. Choose Windows 10 and later as the platform and select Trusted certificate as the profile type.&lt;/p&gt;

&lt;div class=&quot;gallery-box&quot;&gt;
  &lt;div class=&quot;gallery&quot;&gt;
    &lt;img src=&quot;/images/CloudPKI-25.jpg&quot; loading=&quot;lazy&quot; alt=&quot;Post&quot; /&gt;
    &lt;img src=&quot;/images/CloudPKI-15.jpg&quot; loading=&quot;lazy&quot; alt=&quot;Post&quot; /&gt;
  &lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;Create a profile for the Root CA first. Upload the Root CA’s certificate file (in .cer format) and assign the profile to the appropriate device groups. This ensures that all devices in the assigned groups trust the Root CA as a certificate authority. Once the proper assignment is completed hit the create button on the Review + Create tab.&lt;/p&gt;

&lt;div class=&quot;gallery-box&quot;&gt;
  &lt;div class=&quot;gallery&quot;&gt;
    &lt;img src=&quot;/images/CloudPKI-12.jpg&quot; loading=&quot;lazy&quot; alt=&quot;Post&quot; /&gt;
    &lt;img src=&quot;/images/CloudPKI-11.jpg&quot; loading=&quot;lazy&quot; alt=&quot;Post&quot; /&gt;
    &lt;img src=&quot;/images/CloudPKI-10.jpg&quot; loading=&quot;lazy&quot; alt=&quot;Post&quot; /&gt;
  &lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;Repeat the process to create a second configuration profile for the Issuing CA. Similarly, upload the Issuing CA’s certificate file and assign it to the same device groups or additional groups as necessary. By deploying these trusted certificate profiles, you establish a trust chain on Windows devices, allowing them to recognize and trust certificates issued by the Cloud PKI infrastructure. These profiles are critical for ensuring secure communication and authentication within your environment.&lt;/p&gt;

&lt;h3 id=&quot;creating-a-configuration-profile-for-issuing-scep-certificates&quot;&gt;Creating a Configuration Profile for Issuing SCEP Certificates&lt;/h3&gt;

&lt;p&gt;To deploy SCEP certificates using Intune, you need to create a configuration profile that defines how devices will request and receive certificates. Note that you will need to create a SCEP Cert profile for each of the Certificate Stores, that is the Device Cert store as well as the User Cert store depending on what you are needing. Start by navigating to Devices &amp;gt; Configuration profiles &amp;gt; Create profile in the Intune admin center. Select Windows 10 and later as the platform and choose SCEP certificate as the profile type. Provide a name and description for the profile to ensure clarity in your configuration settings.&lt;/p&gt;

&lt;div class=&quot;gallery-box&quot;&gt;
  &lt;div class=&quot;gallery&quot;&gt;
    &lt;img src=&quot;/images/CloudPKI-08.jpg&quot; loading=&quot;lazy&quot; alt=&quot;Post&quot; /&gt;
    &lt;img src=&quot;/images/CloudPKI-07.jpg&quot; loading=&quot;lazy&quot; alt=&quot;Post&quot; /&gt;
  &lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;Next, configure the certificate settings. Specify the Certificate Type (User or Device) and the Subject name format, which changes depending on whether this is a User or Device certificate. There are specific placeholders that will fill in user or device specific identity information that can be used here. This will also be the default values that are used here. Likewise these same placeholders can be used for the SAN fields. Further elaboration on what placeholders can be used in the Subject and SAN fields are documented in the Intune SCEP certificate profile documentation. Define the Certificate validity period, Key storage provider, Key usage, Key size, and Hash algorithm to be used for these certificates ensuring they align with your security requirements. Then upload the Root CA that was downloaded when the Root CA was created. After the Root CA is uploaded select what EKUs that the certificate will be used for. Next, determine when the renewal threshhold will be for the certificates. The recommended renewal threshold is after 80% of the validity period of the certificate, which means we would want to leave 20%. After this period the device can request a new certificate to be issued from Intune. Lastly, provide the SCEP Server URL which can be found on the Issuing CA properties page in the Cloud PKI CA’s page.&lt;/p&gt;

&lt;div class=&quot;gallery-box&quot;&gt;
  &lt;div class=&quot;gallery&quot;&gt;
    &lt;img src=&quot;/images/CloudPKI-06.jpg&quot; loading=&quot;lazy&quot; alt=&quot;Post&quot; /&gt;
    &lt;img src=&quot;/images/CloudPKI-05.jpg&quot; loading=&quot;lazy&quot; alt=&quot;Post&quot; /&gt;
    &lt;img src=&quot;/images/CloudPKI-13.jpg&quot; loading=&quot;lazy&quot; alt=&quot;Post&quot; /&gt;
  &lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;Assign the SCEP profile to the appropriate device groups. This ensures that only authorized devices can request and receive certificates. Once deployed, Intune will automatically manage the certificate provisioning process, streamlining secure access and authentication for your devices.&lt;/p&gt;

&lt;div class=&quot;gallery-box&quot;&gt;
  &lt;div class=&quot;gallery&quot;&gt;
    &lt;img src=&quot;/images/CloudPKI-04.jpg&quot; loading=&quot;lazy&quot; alt=&quot;Post&quot; /&gt;
    &lt;img src=&quot;/images/CloudPKI-03.jpg&quot; loading=&quot;lazy&quot; alt=&quot;Post&quot; /&gt;
  &lt;/div&gt;
&lt;/div&gt;

&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;In this article, we’ve walked through the step-by-step process of deploying Intune’s Cloud PKI solution, starting with the creation of a Root CA and Issuing CA, followed by the deployment of trusted certificates, and concluding with the configuration of SCEP profiles for efficient certificate issuance. These steps ensure a seamless and secure certificate lifecycle management process that integrates smoothly with modern IT environments. By following these instructions, organizations can establish a robust and scalable PKI infrastructure that supports both managed and unmanaged devices.&lt;/p&gt;

&lt;p&gt;Certificates play a critical role in today’s IT infrastructure, underpinning secure communication, authentication, and data integrity. Modernizing certificate management through Intune’s Cloud PKI simplifies the deployment process, reduces administrative overhead, and enhances security. This approach empowers IT professionals to focus on strategic initiatives while minimizing vulnerabilities and ensuring streamlined, efficient device management in a rapidly evolving technological landscape. Changes&lt;/p&gt;
</description>
                <pubDate>Fri, 10 Jan 2025 06:01:35 -0600</pubDate>
                <link>http://localhost:4000/posts/deploying-cloud-pki</link>
                <guid isPermaLink="true">http://localhost:4000/posts/deploying-cloud-pki</guid>
                
                <category>Security</category>
                
                <category>Certificates</category>
                
                <category>MDM</category>
                
                
            </item>
        
    </channel>
</rss>